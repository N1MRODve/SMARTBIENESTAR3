import{e as te,h as U,u as se,s as C,G as D,p as G,A as oe,R as ae}from"./index-D33O_vwf.js";import{_ as R}from"./EmptyState-mSYFNM8S.js";import{d as b,B as M,w as H,o as c,c as le,u as E,j as e,v as d,I as $,z as m,t as r,q as w,H as A,L as O,V as re,G as ie,f as ne,h as u,E as T,b as z,F as J,y as K}from"./vue-vendor-DLSXyIw7.js";import{s as de}from"./dialog.esm-C9zKQD4N.js";import{S as ce}from"./save-BO0ouwoH.js";import{P as Q}from"./plus-n9pYVzkT.js";import{S as ue}from"./square-pen-Bab3IBLH.js";import{T as pe}from"./trash-2-OdR_kCZk.js";import"./supabase-B7V2753y.js";const me={class:"form-group"},ge=["disabled"],ve={class:"form-group"},xe=["disabled"],be={class:"grid grid-cols-2 gap-4"},fe={class:"form-group"},he=["disabled"],_e={class:"form-group"},ye=["disabled"],we={class:"form-group"},$e={class:"flex items-center space-x-3"},ke=["disabled"],Ce={class:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center"},Ee={class:"text-2xl"},je={class:"grid grid-cols-2 gap-4"},Se={class:"form-group"},Me=["disabled"],Ve={class:"form-group"},qe={class:"flex items-center space-x-3 mt-2"},De=["disabled"],Ae={class:"form-group"},Te={class:"p-4 bg-gray-50 rounded-lg border border-gray-200"},Ue={class:"flex items-center"},ze={class:"w-12 h-12 bg-white rounded-lg flex items-center justify-center mr-4 shadow-sm"},Be={class:"text-2xl"},Ie={class:"flex-1"},Ne={class:"font-medium text-gray-900"},Pe={class:"text-sm text-gray-600"},Fe={class:"flex items-center mt-1"},Le={class:"text-sm font-medium text-gray-700"},Ge={class:"flex justify-end space-x-4"},Re={__name:"RecompensaFormModal",props:{visible:{type:Boolean,default:!1},recompensa:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(p,{emit:j}){const f=p,g=j,l=b({titulo:"",descripcion:"",coste:100,categoria:"",icono:"ðŸŽ",popularidad:3,disponible:!0}),x=M({get:()=>f.visible,set:i=>g("update:visible",i)}),h=M(()=>l.value.titulo.trim()&&l.value.descripcion.trim()&&l.value.coste>0&&l.value.categoria&&l.value.icono.trim()),_=()=>{g("update:visible",!1),y()},y=()=>{l.value={titulo:"",descripcion:"",coste:100,categoria:"",icono:"ðŸŽ",popularidad:3,disponible:!0}},v=()=>{h.value&&(console.log("Enviando datos del formulario:",l.value),g("save",{...l.value}))};return H(()=>f.recompensa,i=>{i?(console.log("Editando recompensa:",i),l.value={titulo:i.titulo||"",descripcion:i.descripcion||"",coste:i.coste||100,categoria:i.categoria||"",icono:i.icono||"ðŸŽ",popularidad:i.popularidad||3,disponible:i.disponible!==!1}):y()},{immediate:!0}),H(()=>f.visible,i=>{i||y()}),(i,s)=>(c(),le(m(de),{visible:x.value,"onUpdate:visible":s[7]||(s[7]=n=>x.value=n),modal:"",header:p.recompensa?"Editar Recompensa":"Nueva Recompensa",style:{width:"600px"},closable:!p.loading},{footer:E(()=>[e("div",Ge,[d(U,{onClick:_,variant:"outline",disabled:p.loading},{default:E(()=>s[21]||(s[21]=[$(" Cancelar ")])),_:1,__:[21]},8,["disabled"]),d(U,{onClick:v,loading:p.loading,disabled:!h.value},{default:E(()=>[d(m(ce),{class:"h-4 w-4 mr-2"}),$(" "+r(p.recompensa?"Actualizar":"Crear")+" Recompensa ",1)]),_:1},8,["loading","disabled"])])]),default:E(()=>[e("form",{onSubmit:ie(v,["prevent"]),class:"space-y-6"},[e("div",me,[s[8]||(s[8]=e("label",{for:"titulo",class:"form-label"}," TÃ­tulo de la Recompensa * ",-1)),w(e("input",{id:"titulo","onUpdate:modelValue":s[0]||(s[0]=n=>l.value.titulo=n),type:"text",class:"input",placeholder:"Ej: DÃ­a Libre Adicional",required:"",disabled:p.loading},null,8,ge),[[A,l.value.titulo]])]),e("div",ve,[s[9]||(s[9]=e("label",{for:"descripcion",class:"form-label"}," DescripciÃ³n * ",-1)),w(e("textarea",{id:"descripcion","onUpdate:modelValue":s[1]||(s[1]=n=>l.value.descripcion=n),rows:"3",class:"input resize-none",placeholder:"Describe brevemente la recompensa...",required:"",disabled:p.loading},null,8,xe),[[A,l.value.descripcion]])]),e("div",be,[e("div",fe,[s[10]||(s[10]=e("label",{for:"coste",class:"form-label"}," Coste en Puntos * ",-1)),w(e("input",{id:"coste","onUpdate:modelValue":s[2]||(s[2]=n=>l.value.coste=n),type:"number",class:"input",min:"1",max:"1000",step:"5",required:"",disabled:p.loading},null,8,he),[[A,l.value.coste]])]),e("div",_e,[s[12]||(s[12]=e("label",{for:"categoria",class:"form-label"}," CategorÃ­a * ",-1)),w(e("select",{id:"categoria","onUpdate:modelValue":s[3]||(s[3]=n=>l.value.categoria=n),class:"input",required:"",disabled:p.loading},s[11]||(s[11]=[e("option",{value:""},"Selecciona categorÃ­a",-1),e("option",{value:"tiempo"},"â° Tiempo Libre",-1),e("option",{value:"bienestar"},"ðŸ’†â€â™€ï¸ Bienestar",-1),e("option",{value:"gastronomia"},"ðŸ½ï¸ GastronomÃ­a",-1),e("option",{value:"compras"},"ðŸŽ Compras",-1),e("option",{value:"entretenimiento"},"ðŸŽ¬ Entretenimiento",-1),e("option",{value:"comodidad"},"ðŸš— Comodidad",-1),e("option",{value:"salud"},"ðŸ¥— Salud",-1)]),8,ye),[[O,l.value.categoria]])])]),e("div",we,[s[13]||(s[13]=e("label",{for:"icono",class:"form-label"}," Icono (Emoji) * ",-1)),e("div",$e,[w(e("input",{id:"icono","onUpdate:modelValue":s[4]||(s[4]=n=>l.value.icono=n),type:"text",class:"input flex-1",placeholder:"ðŸŽ",maxlength:"2",required:"",disabled:p.loading},null,8,ke),[[A,l.value.icono]]),e("div",Ce,[e("span",Ee,r(l.value.icono||"â“"),1)])]),s[14]||(s[14]=e("p",{class:"mt-1 text-xs text-gray-500"}," Usa un emoji que represente la recompensa ",-1))]),e("div",je,[e("div",Se,[s[16]||(s[16]=e("label",{for:"popularidad",class:"form-label"}," Popularidad (1-5 estrellas) ",-1)),w(e("select",{id:"popularidad","onUpdate:modelValue":s[5]||(s[5]=n=>l.value.popularidad=n),class:"input",disabled:p.loading},s[15]||(s[15]=[e("option",{value:1},"â­ (1 estrella)",-1),e("option",{value:2},"â­â­ (2 estrellas)",-1),e("option",{value:3},"â­â­â­ (3 estrellas)",-1),e("option",{value:4},"â­â­â­â­ (4 estrellas)",-1),e("option",{value:5},"â­â­â­â­â­ (5 estrellas)",-1)]),8,Me),[[O,l.value.popularidad]])]),e("div",Ve,[s[18]||(s[18]=e("label",{class:"form-label"}," Estado ",-1)),e("div",qe,[w(e("input",{id:"disponible","onUpdate:modelValue":s[6]||(s[6]=n=>l.value.disponible=n),type:"checkbox",class:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded",disabled:p.loading},null,8,De),[[re,l.value.disponible]]),s[17]||(s[17]=e("label",{for:"disponible",class:"text-sm text-gray-700"}," Disponible para canje ",-1))])])]),e("div",Ae,[s[20]||(s[20]=e("label",{class:"form-label"},"Vista Previa",-1)),e("div",Te,[e("div",Ue,[e("div",ze,[e("span",Be,r(l.value.icono||"â“"),1)]),e("div",Ie,[e("h4",Ne,r(l.value.titulo||"TÃ­tulo de la recompensa"),1),e("p",Pe,r(l.value.descripcion||"DescripciÃ³n de la recompensa"),1),e("div",Fe,[s[19]||(s[19]=e("svg",{class:"w-4 h-4 text-yellow-500 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})],-1)),e("span",Le,r(l.value.coste||0)+" puntos",1)])])])])])],32)]),_:1},8,["visible","header","closable"]))}},He=te(Re,[["__scopeId","data-v-e824570a"]]),Oe={class:"space-y-8"},Je={class:"bg-gradient-to-r from-orange-600 to-pink-600 rounded-2xl shadow-xl p-8"},Ke={class:"flex items-center justify-between"},Qe={class:"flex items-center space-x-4"},We={class:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center"},Xe={class:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden"},Ye={class:"border-b border-gray-200"},Ze={class:"flex space-x-8 px-6","aria-label":"Tabs"},et={class:"flex items-center"},tt={class:"flex items-center"},st={key:0,class:"ml-2 bg-orange-600 text-white text-xs px-2 py-1 rounded-full"},ot={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-6"},at={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},lt={class:"text-3xl font-bold text-orange-600"},rt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},it={class:"text-3xl font-bold text-green-600"},nt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},dt={class:"text-3xl font-bold text-blue-600"},ct={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},ut={class:"text-3xl font-bold text-purple-600"},pt={key:1,class:"flex items-center justify-center py-12"},mt={key:2,class:"bg-red-50 border border-red-200 rounded-xl p-8 text-center"},gt={class:"text-red-600 mb-4"},vt={key:3},xt={key:0,class:"bg-white rounded-xl shadow-lg border border-gray-200"},bt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ft={class:"h-48 bg-gradient-to-br from-orange-400 to-pink-500 flex items-center justify-center"},ht={class:"p-6"},_t={class:"flex items-start justify-between mb-2"},yt={class:"text-lg font-bold text-gray-900"},wt={class:"text-sm text-gray-600 mb-4"},$t={class:"flex items-center justify-between mb-4"},kt={class:"text-xl font-bold text-orange-600"},Ct={class:"text-right"},Et={class:"text-lg font-semibold text-gray-900"},jt={class:"flex gap-2"},St=["onClick"],Mt=["onClick"],Vt={key:4},qt={key:0,class:"bg-white rounded-xl shadow-lg border border-gray-200"},Dt={key:1,class:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden"},At={class:"overflow-x-auto"},Tt={class:"w-full"},Ut={class:"divide-y divide-gray-200"},zt={class:"px-6 py-4 whitespace-nowrap"},Bt={class:"text-sm text-gray-900"},It={class:"text-xs text-gray-500"},Nt={class:"px-6 py-4 whitespace-nowrap"},Pt={class:"flex items-center"},Ft={class:"w-10 h-10 bg-orange-600 rounded-full flex items-center justify-center mr-3"},Lt={class:"text-white font-medium text-sm"},Gt={class:"text-sm font-medium text-gray-900"},Rt={class:"text-xs text-gray-500"},Ht={class:"px-6 py-4"},Ot={class:"text-sm font-medium text-gray-900"},Jt={class:"text-xs text-gray-500 capitalize"},Kt={class:"px-6 py-4 whitespace-nowrap"},Qt={class:"text-sm font-bold text-orange-600"},Wt={class:"px-6 py-4 whitespace-nowrap"},rs={__name:"GestionRecompensasView",setup(p){const j=se(),f=b([]),g=b([]),l=b(!0),x=b(null),h=b(!1),_=b(null),y=b(!1),v=b("recompensas"),i=M(()=>g.value.length),s=M(()=>{const o=new Date;return o.setDate(1),o.setHours(0,0,0,0),g.value.filter(t=>new Date(t.fecha_canje)>=o).length}),n=M(()=>g.value.reduce((o,t)=>o+(t.puntos_gastados||0),0));ne(async()=>{await V()});const B=async o=>{v.value=o,o==="historial"&&g.value.length===0&&await I()},V=async()=>{l.value=!0,x.value=null;try{const{data:o,error:t}=await C.from("recompensas").select("*").eq("empresa_id",j.empresaId).order("created_at",{ascending:!1});if(t)throw t;f.value=o||[]}catch(o){console.error("Error cargando recompensas:",o),x.value="No se pudieron cargar las recompensas"}finally{l.value=!1}},I=async()=>{l.value=!0,x.value=null;try{const{data:o,error:t}=await C.from("recompensas").select("id").eq("empresa_id",j.empresaId);if(t)throw t;const a=o.map(q=>q.id);if(a.length===0){g.value=[],l.value=!1;return}const{data:k,error:S}=await C.from("canjes_recompensas").select(`
        *,
        empleado:empleados(nombre, email),
        recompensa:recompensas(nombre, categoria, imagen_url)
      `).in("recompensa_id",a).order("fecha_canje",{ascending:!1});if(S)throw S;g.value=k||[]}catch(o){console.error("Error cargando historial:",o),x.value="No se pudo cargar el historial de canjes"}finally{l.value=!1}},N=()=>{_.value=null,h.value=!0},W=o=>{_.value={...o},h.value=!0},X=async o=>{var t;y.value=!0;try{if((t=_.value)!=null&&t.id){const{error:a}=await C.from("recompensas").update({nombre:o.nombre,descripcion:o.descripcion,categoria:o.categoria,costo_puntos:o.costo_puntos,stock:o.stock,imagen_url:o.imagen_url,activa:o.activa}).eq("id",_.value.id);if(a)throw a}else{const{error:a}=await C.from("recompensas").insert([{empresa_id:j.empresaId,nombre:o.nombre,descripcion:o.descripcion,categoria:o.categoria,costo_puntos:o.costo_puntos,stock:o.stock||-1,imagen_url:o.imagen_url,activa:o.activa!==!1}]);if(a)throw a}await V(),h.value=!1}catch(a){console.error("Error guardando recompensa:",a),alert("Error al guardar la recompensa")}finally{y.value=!1}},Y=async o=>{if(confirm("Â¿EstÃ¡s seguro de eliminar esta recompensa?"))try{const{error:t}=await C.from("recompensas").delete().eq("id",o);if(t)throw t;await V()}catch(t){console.error("Error eliminando recompensa:",t),alert("Error al eliminar la recompensa")}},Z=o=>new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short"}),ee=o=>new Date(o).toLocaleString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(o,t)=>(c(),u("div",Oe,[e("div",Je,[e("div",Ke,[e("div",Qe,[e("div",We,[d(m(D),{class:"h-8 w-8 text-white"})]),t[4]||(t[4]=e("div",null,[e("h1",{class:"text-3xl font-bold text-white"},"GestiÃ³n de Recompensas"),e("p",{class:"text-white/80 mt-1"},"Administra el catÃ¡logo y controla los canjes")],-1))]),d(U,{onClick:N,class:"bg-white text-orange-600 font-semibold hover:bg-orange-50"},{default:E(()=>[d(m(Q),{class:"h-5 w-5 mr-2"}),t[5]||(t[5]=$(" Nueva Recompensa "))]),_:1,__:[5]})])]),e("div",Xe,[e("div",Ye,[e("nav",Ze,[e("button",{onClick:t[0]||(t[0]=a=>B("recompensas")),class:T(["py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",v.value==="recompensas"?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"])},[e("div",et,[d(m(D),{class:"h-5 w-5 mr-2"}),$(" CatÃ¡logo ("+r(f.value.length)+") ",1)])],2),e("button",{onClick:t[1]||(t[1]=a=>B("historial")),class:T(["py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",v.value==="historial"?"border-orange-600 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700"])},[e("div",tt,[d(m(G),{class:"h-5 w-5 mr-2"}),t[6]||(t[6]=$(" Historial de Canjes ")),i.value>0?(c(),u("span",st,r(i.value),1)):z("",!0)])],2)])])]),v.value==="historial"?(c(),u("div",ot,[e("div",at,[e("div",lt,r(i.value),1),t[7]||(t[7]=e("div",{class:"text-sm text-gray-600 mt-1"},"Total Canjes",-1))]),e("div",rt,[e("div",it,r(s.value),1),t[8]||(t[8]=e("div",{class:"text-sm text-gray-600 mt-1"},"Este Mes",-1))]),e("div",nt,[e("div",dt,r(n.value),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600 mt-1"},"Puntos Canjeados",-1))]),e("div",ct,[e("div",ut,r(Math.round(n.value/Math.max(i.value,1))),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-600 mt-1"},"Promedio por Canje",-1))])])):z("",!0),l.value?(c(),u("div",pt,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"},null,-1)]))):x.value?(c(),u("div",mt,[d(m(oe),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),t[13]||(t[13]=e("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar datos",-1)),e("p",gt,r(x.value),1),d(U,{onClick:t[2]||(t[2]=a=>v.value==="recompensas"?V():I())},{default:E(()=>[d(m(ae),{class:"h-4 w-4 mr-2"}),t[12]||(t[12]=$(" Reintentar "))]),_:1,__:[12]})])):v.value==="recompensas"?(c(),u("div",vt,[f.value.length===0?(c(),u("div",xt,[d(R,{icon:m(D),title:"No hay recompensas",description:"Comienza creando tu primera recompensa para motivar a tu equipo.","action-text":"Crear recompensa","action-icon":m(Q),onAction:N},null,8,["icon","action-icon"])])):(c(),u("div",bt,[(c(!0),u(J,null,K(f.value,a=>(c(),u("div",{key:a.id,class:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow"},[e("div",ft,[d(m(D),{class:"h-20 w-20 text-white"})]),e("div",ht,[e("div",_t,[e("h3",yt,r(a.nombre),1),e("span",{class:T([a.activa?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800","px-2 py-1 text-xs font-medium rounded-full"])},r(a.activa?"Activa":"Inactiva"),3)]),e("p",wt,r(a.descripcion),1),e("div",$t,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-xs text-gray-500"},"Costo",-1)),e("div",kt,r(a.costo_puntos)+" pts",1)]),e("div",Ct,[t[15]||(t[15]=e("span",{class:"text-xs text-gray-500"},"Stock",-1)),e("div",Et,r(a.stock===-1?"Ilimitado":a.stock),1)])]),e("div",jt,[e("button",{onClick:k=>W(a),class:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"},[d(m(ue),{class:"h-4 w-4 inline mr-1"}),t[16]||(t[16]=$(" Editar "))],8,St),e("button",{onClick:k=>Y(a.id),class:"bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors"},[d(m(pe),{class:"h-4 w-4"})],8,Mt)])])]))),128))]))])):v.value==="historial"?(c(),u("div",Vt,[g.value.length===0?(c(),u("div",qt,[d(R,{icon:m(G),title:"Sin canjes aÃºn",description:"Los canjes realizados por los empleados aparecerÃ¡n aquÃ­."},null,8,["icon"])])):(c(),u("div",Dt,[e("div",At,[e("table",Tt,[t[17]||(t[17]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase"},"Fecha"),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase"},"Empleado"),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase"},"Recompensa"),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase"},"Puntos"),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase"},"Estado")])],-1)),e("tbody",Ut,[(c(!0),u(J,null,K(g.value,a=>{var k,S,q,P,F,L;return c(),u("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",zt,[e("div",Bt,r(Z(a.fecha_canje)),1),e("div",It,r(ee(a.fecha_canje)),1)]),e("td",Nt,[e("div",Pt,[e("div",Ft,[e("span",Lt,r(((S=(k=a.empleado)==null?void 0:k.nombre)==null?void 0:S.charAt(0))||"E"),1)]),e("div",null,[e("div",Gt,r(((q=a.empleado)==null?void 0:q.nombre)||"Empleado"),1),e("div",Rt,r((P=a.empleado)==null?void 0:P.email),1)])])]),e("td",Ht,[e("div",Ot,r((F=a.recompensa)==null?void 0:F.nombre),1),e("div",Jt,r((L=a.recompensa)==null?void 0:L.categoria),1)]),e("td",Kt,[e("span",Qt,r(a.puntos_gastados)+" pts",1)]),e("td",Wt,[e("span",{class:T([{"bg-green-100 text-green-800":a.estado==="completado","bg-yellow-100 text-yellow-800":a.estado==="pendiente","bg-blue-100 text-blue-800":a.estado==="procesado"},"px-3 py-1 text-xs font-medium rounded-full capitalize"])},r(a.estado),3)])])}),128))])])])]))])):z("",!0),d(He,{visible:h.value,"onUpdate:visible":t[3]||(t[3]=a=>h.value=a),recompensa:_.value,loading:y.value,onSave:X},null,8,["visible","recompensa","loading"])]))}};export{rs as default};

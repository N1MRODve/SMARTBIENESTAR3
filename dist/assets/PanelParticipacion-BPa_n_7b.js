const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C3zR6LNs.js","assets/vue-vendor-B77bLtTV.js","assets/supabase-B7V2753y.js","assets/charts-CTwtOHf5.js","assets/index-HvGzjyQs.css"])))=>i.map(i=>d[i]);
import{_ as $}from"./supabase-B7V2753y.js";import{u as L,s as E,w as K,C as H,x as F,F as I,B as J,y as U,i as G}from"./index-C3zR6LNs.js";import{d as _,B as j,f as Q,o as n,h as i,j as e,F as b,t as r,v as p,z as g,y as R,E as x,K as M,J as y,b as S}from"./vue-vendor-B77bLtTV.js";import"./charts-CTwtOHf5.js";const W={class:"min-h-screen bg-gray-50"},X={class:"py-8"},Y={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Z={key:0,class:"flex items-center justify-center py-12"},ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},te={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},se={class:"flex items-center justify-between"},oe={class:"text-3xl font-bold text-indigo-600"},ae={class:"w-14 h-14 rounded-full bg-indigo-100 flex items-center justify-center"},re={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ne={class:"flex items-center justify-between"},ie={class:"text-3xl font-bold text-green-600"},de={class:"text-xs text-gray-500 mt-1"},le={class:"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center"},ce={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ue={class:"flex items-center justify-between"},me={class:"text-3xl font-bold text-blue-600"},pe={class:"w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center"},ge={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},xe={class:"flex items-center justify-between"},ve={class:"text-3xl font-bold text-gray-900"},fe={class:"text-xs text-gray-500 mt-1"},he={class:"w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center"},_e={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center"},be={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8"},ye={class:"flex items-center mb-6"},we={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3"},Ee={class:"space-y-4"},je={class:"w-32 flex-shrink-0"},Ce={class:"text-xs font-medium text-gray-500"},ke={class:"flex-1"},Ae={class:"flex items-center justify-between mb-1"},De={class:"text-sm font-medium text-gray-900"},Pe={class:"relative w-full bg-gray-200 rounded-full h-3"},Te={class:"text-xs text-gray-500 mt-1"},Re={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8"},Me={class:"flex items-center mb-6"},Se={class:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mr-3"},ze={class:"space-y-6"},Be={class:"flex items-center justify-between mb-4"},Fe={class:"flex-1"},Ie={class:"text-lg font-bold text-gray-900 mb-1"},qe={class:"text-sm text-gray-600"},Ne={key:0},Oe={class:"text-right ml-4"},Ve={class:"text-xs text-gray-500"},$e={class:"mb-4"},Le={class:"relative w-full bg-gray-200 rounded-full h-3"},Ke={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-3"},He={class:"text-xs font-medium text-gray-700 mb-1"},Je={class:"flex items-center justify-between"},Ue={class:"text-xs text-gray-500"},Ge={class:"mt-2 w-full bg-gray-200 rounded-full h-1.5"},Qe={key:0,class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6"},We={class:"bg-green-50 border-2 border-green-200 rounded-xl p-6"},Xe={class:"flex items-start"},Ye={class:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0"},Ze={class:"text-sm text-green-800 mb-3"},et={class:"bg-orange-50 border-2 border-orange-200 rounded-xl p-6"},tt={class:"flex items-start"},st={class:"w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0"},ot={class:"text-sm text-orange-800 mb-3"},lt={__name:"PanelParticipacion",setup(at){const w=L(),l=_([]),u=_([]),C=_([]),v=_([]),k=_(!0),f=j(()=>{const o=l.value.filter(d=>d.estado==="activa"||d.estado==="Activa").length,s=l.value.filter(d=>d.estado==="finalizada"||d.estado==="Finalizada").length,t=u.value.length,a=v.value.length;let c=0;return t>0&&l.value.length>0&&(c=Math.round(a/(t*l.value.length)*100)),{tasaPromedio:c,totalRespondidos:a,totalEnviados:t*l.value.length,encuestasActivas:o,totalEncuestas:l.value.length,encuestasCerradas:s}}),q=j(()=>l.value.map(o=>{const s=v.value.filter(a=>a.encuesta_id===o.id),t=u.value.length>0?Math.round(s.length/u.value.length*100):0;return{fecha:o.fecha_creacion,encuesta:o.titulo,tasa:t,respondidos:s.length,enviados:u.value.length}}).slice(0,10)),z=j(()=>l.value.map(o=>{const s=v.value.filter(a=>a.encuesta_id===o.id),t=C.value.map(a=>{const c=u.value.filter(T=>T.departamento_id===a.id),d=s.filter(T=>{const B=u.value.find(V=>V.id===T.empleado_id);return B&&B.departamento_id===a.id});return{nombre:a.nombre,enviados:c.length,respondidos:d.length}});return{id:o.id,titulo:o.titulo,estado:o.estado,fecha_envio:o.fecha_inicio||o.fecha_creacion,fecha_cierre:o.fecha_fin,enviados:u.value.length,respondidos:s.length,departamentos:t}})),h=j(()=>{const o=[];z.value.forEach(t=>{t.departamentos.forEach(a=>{const c=o.find(d=>d.nombre===a.nombre);c?(c.enviados+=a.enviados,c.respondidos+=a.respondidos):o.push({...a})})});const s=o.filter(t=>t.enviados>0).map(t=>({...t,tasa:Math.round(t.respondidos/t.enviados*100)})).sort((t,a)=>a.tasa-t.tasa);return{mejor:s[0]||{nombre:"-",tasa:0},peor:s[s.length-1]||{nombre:"-",tasa:0}}});Q(async()=>{await N()});const N=async()=>{k.value=!0;try{if(w.isDemoMode){const{FITCORP_MOCK_DATA:o}=await $(async()=>{const{FITCORP_MOCK_DATA:t}=await import("./index-C3zR6LNs.js").then(a=>a.a3);return{FITCORP_MOCK_DATA:t}},__vite__mapDeps([0,1,2,3,4]));l.value=o.participacion.encuestasDetalle.map(t=>({id:t.id,titulo:t.titulo,estado:t.estado,fecha_creacion:t.fecha_envio,fecha_inicio:t.fecha_envio,fecha_fin:t.fecha_cierre}));const s=o.estadisticas.dashboard.totalEmpleados;u.value=Array.from({length:s},(t,a)=>({id:`emp-${String(a+1).padStart(3,"0")}`,departamento_id:o.departamentos[a%o.departamentos.length].id})),C.value=o.departamentos,v.value=[],o.participacion.encuestasDetalle.forEach(t=>{for(let a=0;a<t.respondidos;a++)v.value.push({encuesta_id:t.id,empleado_id:`emp-${String(a+1).padStart(3,"0")}`})})}else{const[o,s,t,a]=await Promise.all([E.from("encuestas").select("*").eq("empresa_id",w.empresaId).order("fecha_creacion",{ascending:!1}),E.from("empleados").select("id, departamento_id").eq("empresa_id",w.empresaId).eq("estado","Activo"),E.from("departamentos").select("id, nombre").eq("empresa_id",w.empresaId),E.from("respuestas_encuesta").select("encuesta_id, empleado_id")]);if(o.error)throw o.error;if(s.error)throw s.error;if(t.error)throw t.error;if(a.error)throw a.error;l.value=o.data||[],u.value=s.data||[],C.value=t.data||[];const c=l.value.map(d=>d.id);v.value=(a.data||[]).filter(d=>c.includes(d.encuesta_id))}}catch(o){console.error("Error cargando datos:",o)}finally{k.value=!1}},m=(o,s)=>o===0?0:Math.round(s/o*100),A=o=>o?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",D=o=>o>=80?"text-green-600":o>=60?"text-blue-600":o>=40?"text-orange-600":"text-red-600",P=o=>o>=80?"bg-green-500":o>=60?"bg-blue-500":o>=40?"bg-orange-500":"bg-red-500",O=o=>o>=80?"border-green-200 bg-green-50/50":o>=60?"border-blue-200 bg-blue-50/50":o>=40?"border-orange-200 bg-orange-50/50":"border-red-200 bg-red-50/50";return(o,s)=>(n(),i("div",W,[e("div",X,[e("div",Y,[s[19]||(s[19]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Panel de Participación"),e("p",{class:"text-gray-600 mt-2"},"Monitorea en tiempo real el avance de las encuestas y la tasa de respuesta por área")],-1)),k.value?(n(),i("div",Z,s[0]||(s[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)]))):(n(),i(b,{key:1},[e("div",ee,[e("div",te,[e("div",se,[e("div",null,[s[1]||(s[1]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Tasa Promedio",-1)),e("p",oe,r(f.value.tasaPromedio)+"%",1),s[2]||(s[2]=e("p",{class:"text-xs text-gray-500 mt-1"},"En todas las encuestas",-1))]),e("div",ae,[p(g(K),{class:"h-7 w-7 text-indigo-600"})])])]),e("div",re,[e("div",ne,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Total Respuestas",-1)),e("p",ie,r(f.value.totalRespondidos),1),e("p",de,"de "+r(f.value.totalEnviados)+" posibles",1)]),e("div",le,[p(g(H),{class:"h-7 w-7 text-green-600"})])])]),e("div",ce,[e("div",ue,[e("div",null,[s[4]||(s[4]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Encuestas Activas",-1)),e("p",me,r(f.value.encuestasActivas),1),s[5]||(s[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"En curso",-1))]),e("div",pe,[p(g(F),{class:"h-7 w-7 text-blue-600"})])])]),e("div",ge,[e("div",xe,[e("div",null,[s[6]||(s[6]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Total Encuestas",-1)),e("p",ve,r(f.value.totalEncuestas),1),e("p",fe,r(f.value.encuestasCerradas)+" cerradas",1)]),e("div",he,[p(g(I),{class:"h-7 w-7 text-gray-600"})])])])]),l.value.length===0?(n(),i("div",_e,[p(g(I),{class:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s[7]||(s[7]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay encuestas aún",-1)),s[8]||(s[8]=e("p",{class:"text-gray-500"},"Crea encuestas para empezar a monitorear la participación de tu equipo.",-1))])):(n(),i(b,{key:1},[e("div",be,[e("div",ye,[e("div",we,[p(g(J),{class:"h-5 w-5 text-white"})]),s[9]||(s[9]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Evolución de Participación"),e("p",{class:"text-sm text-gray-600"},"Histórico de tasas de respuesta por encuesta")],-1))]),e("div",Ee,[(n(!0),i(b,null,R(q.value,t=>(n(),i("div",{key:t.encuesta,class:"flex items-center gap-4"},[e("div",je,[e("p",Ce,r(A(t.fecha)),1)]),e("div",ke,[e("div",Ae,[e("p",De,r(t.encuesta),1),e("span",{class:x(["text-sm font-bold",D(t.tasa)])},r(t.tasa)+"% ",3)]),e("div",Pe,[e("div",{class:x(["h-3 rounded-full transition-all duration-500",P(t.tasa)]),style:M({width:`${t.tasa}%`})},null,6)]),e("p",Te,r(t.respondidos)+"/"+r(t.enviados)+" empleados",1)])]))),128))])]),e("div",Re,[e("div",Me,[e("div",Se,[p(g(F),{class:"h-5 w-5 text-white"})]),s[10]||(s[10]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Participación por Departamento"),e("p",{class:"text-sm text-gray-600"},"Detalle de respuestas por área organizacional")],-1))]),e("div",ze,[(n(!0),i(b,null,R(z.value,t=>(n(),i("div",{key:t.id,class:x(["border rounded-xl p-6",O(m(t.enviados,t.respondidos))])},[e("div",Be,[e("div",Fe,[e("h3",Ie,r(t.titulo),1),e("p",qe,[y(" Enviada: "+r(A(t.fecha_envio))+" ",1),t.fecha_cierre?(n(),i("span",Ne," • Cierre: "+r(A(t.fecha_cierre)),1)):S("",!0)])]),e("div",Oe,[e("p",{class:x(["text-3xl font-bold",D(m(t.enviados,t.respondidos))])},r(m(t.enviados,t.respondidos))+"% ",3),e("p",Ve,r(t.respondidos)+"/"+r(t.enviados),1)])]),e("div",$e,[e("div",Le,[e("div",{class:x(["h-3 rounded-full transition-all duration-500",P(m(t.enviados,t.respondidos))]),style:M({width:`${m(t.enviados,t.respondidos)}%`})},null,6)])]),t.departamentos.length>0?(n(),i("div",Ke,[(n(!0),i(b,null,R(t.departamentos,a=>(n(),i("div",{key:a.nombre,class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},[e("p",He,r(a.nombre),1),e("div",Je,[e("p",{class:x(["text-lg font-bold",D(m(a.enviados,a.respondidos))])},r(m(a.enviados,a.respondidos))+"% ",3),e("p",Ue,r(a.respondidos)+"/"+r(a.enviados),1)]),e("div",Ge,[e("div",{class:x(["h-1.5 rounded-full transition-all",P(m(a.enviados,a.respondidos))]),style:M({width:`${m(a.enviados,a.respondidos)}%`})},null,6)])]))),128))])):S("",!0)],2))),128))])]),h.value.mejor.nombre!=="-"?(n(),i("div",Qe,[e("div",We,[e("div",Xe,[e("div",Ye,[p(g(U),{class:"h-6 w-6 text-white"})]),e("div",null,[s[13]||(s[13]=e("h3",{class:"text-lg font-bold text-green-900 mb-2"},"Mejor Participación",-1)),e("p",Ze,[e("strong",null,r(h.value.mejor.nombre),1),s[11]||(s[11]=y(" lidera con una tasa de ")),e("strong",null,r(h.value.mejor.tasa)+"%",1),s[12]||(s[12]=y(" de participación. "))]),s[14]||(s[14]=e("p",{class:"text-xs text-green-700"}," ¡Excelente compromiso! Considera compartir sus prácticas con otros departamentos. ",-1))])])]),e("div",et,[e("div",tt,[e("div",st,[p(g(G),{class:"h-6 w-6 text-white"})]),e("div",null,[s[17]||(s[17]=e("h3",{class:"text-lg font-bold text-orange-900 mb-2"},"Requiere Atención",-1)),e("p",ot,[e("strong",null,r(h.value.peor.nombre),1),s[15]||(s[15]=y(" tiene una tasa de ")),e("strong",null,r(h.value.peor.tasa)+"%",1),s[16]||(s[16]=y(" de participación. "))]),s[18]||(s[18]=e("p",{class:"text-xs text-orange-700"}," Considera enviar recordatorios personalizados o investigar posibles barreras de participación. ",-1))])])])])):S("",!0)],64))],64))])])]))}};export{lt as default};

import{u as $,s as w,T as H,C as U,l as F,F as S,B as G}from"./index-D33O_vwf.js";import{A as J}from"./award-hHVJkT0t.js";import{A as K}from"./alert-triangle-Dg4Dpai8.js";import{d as h,B as j,f as O,h as n,j as e,F as b,t as a,v as m,z as g,y as D,I as _,b as R,o as i,E as x,M as z}from"./vue-vendor-DLSXyIw7.js";import"./supabase-B7V2753y.js";const Q={class:"min-h-screen bg-gray-50"},W={class:"py-8"},X={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Y={key:0,class:"flex items-center justify-center py-12"},Z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ee={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},se={class:"flex items-center justify-between"},te={class:"text-3xl font-bold text-indigo-600"},oe={class:"w-14 h-14 rounded-full bg-indigo-100 flex items-center justify-center"},re={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ae={class:"flex items-center justify-between"},ne={class:"text-3xl font-bold text-green-600"},ie={class:"text-xs text-gray-500 mt-1"},de={class:"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center"},le={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ce={class:"flex items-center justify-between"},ue={class:"text-3xl font-bold text-blue-600"},me={class:"w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center"},ge={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},pe={class:"flex items-center justify-between"},xe={class:"text-3xl font-bold text-gray-900"},ve={class:"text-xs text-gray-500 mt-1"},fe={class:"w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center"},he={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center"},be={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8"},_e={class:"flex items-center mb-6"},ye={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3"},we={class:"space-y-4"},je={class:"w-32 flex-shrink-0"},Ee={class:"text-xs font-medium text-gray-500"},Ce={class:"flex-1"},ke={class:"flex items-center justify-between mb-1"},Ae={class:"text-sm font-medium text-gray-900"},Pe={class:"relative w-full bg-gray-200 rounded-full h-3"},Te={class:"text-xs text-gray-500 mt-1"},De={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8"},Re={class:"flex items-center mb-6"},ze={class:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mr-3"},Be={class:"space-y-6"},Me={class:"flex items-center justify-between mb-4"},qe={class:"flex-1"},Fe={class:"text-lg font-bold text-gray-900 mb-1"},Se={class:"text-sm text-gray-600"},Ie={key:0},Ne={class:"text-right ml-4"},Ve={class:"text-xs text-gray-500"},Le={class:"mb-4"},$e={class:"relative w-full bg-gray-200 rounded-full h-3"},He={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Ue={class:"text-xs font-medium text-gray-700 mb-1"},Ge={class:"flex items-center justify-between"},Je={class:"text-xs text-gray-500"},Ke={class:"mt-2 w-full bg-gray-200 rounded-full h-1.5"},Oe={key:0,class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6"},Qe={class:"bg-green-50 border-2 border-green-200 rounded-xl p-6"},We={class:"flex items-start"},Xe={class:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0"},Ye={class:"text-sm text-green-800 mb-3"},Ze={class:"bg-orange-50 border-2 border-orange-200 rounded-xl p-6"},es={class:"flex items-start"},ss={class:"w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center mr-4 flex-shrink-0"},ts={class:"text-sm text-orange-800 mb-3"},ls={__name:"PanelParticipacion",setup(os){const E=$(),l=h([]),p=h([]),B=h([]),y=h([]),C=h(!0),v=j(()=>{const o=l.value.filter(d=>d.estado==="activa"||d.estado==="Activa").length,s=l.value.filter(d=>d.estado==="finalizada"||d.estado==="Finalizada").length,t=p.value.length,r=y.value.length;let c=0;return t>0&&l.value.length>0&&(c=Math.round(r/(t*l.value.length)*100)),{tasaPromedio:c,totalRespondidos:r,totalEnviados:t*l.value.length,encuestasActivas:o,totalEncuestas:l.value.length,encuestasCerradas:s}}),I=j(()=>l.value.map(o=>{const s=y.value.filter(r=>r.encuesta_id===o.id),t=p.value.length>0?Math.round(s.length/p.value.length*100):0;return{fecha:o.fecha_creacion,encuesta:o.titulo,tasa:t,respondidos:s.length,enviados:p.value.length}}).slice(0,10)),M=j(()=>l.value.map(o=>{const s=y.value.filter(r=>r.encuesta_id===o.id),t=B.value.map(r=>{const c=p.value.filter(T=>T.departamento_id===r.id),d=s.filter(T=>{const q=p.value.find(L=>L.id===T.empleado_id);return q&&q.departamento_id===r.id});return{nombre:r.nombre,enviados:c.length,respondidos:d.length}});return{id:o.id,titulo:o.titulo,estado:o.estado,fecha_envio:o.fecha_inicio||o.fecha_creacion,fecha_cierre:o.fecha_fin,enviados:p.value.length,respondidos:s.length,departamentos:t}})),f=j(()=>{const o=[];M.value.forEach(t=>{t.departamentos.forEach(r=>{const c=o.find(d=>d.nombre===r.nombre);c?(c.enviados+=r.enviados,c.respondidos+=r.respondidos):o.push({...r})})});const s=o.filter(t=>t.enviados>0).map(t=>({...t,tasa:Math.round(t.respondidos/t.enviados*100)})).sort((t,r)=>r.tasa-t.tasa);return{mejor:s[0]||{nombre:"-",tasa:0},peor:s[s.length-1]||{nombre:"-",tasa:0}}});O(async()=>{await N()});const N=async()=>{C.value=!0;try{const[o,s,t,r]=await Promise.all([w.from("encuestas").select("*").eq("empresa_id",E.empresaId).order("fecha_creacion",{ascending:!1}),w.from("empleados").select("id, departamento_id").eq("empresa_id",E.empresaId).eq("estado","Activo"),w.from("departamentos").select("id, nombre").eq("empresa_id",E.empresaId),w.from("respuestas_encuesta").select("encuesta_id, empleado_id")]);if(o.error)throw o.error;if(s.error)throw s.error;if(t.error)throw t.error;if(r.error)throw r.error;l.value=o.data||[],p.value=s.data||[],B.value=t.data||[];const c=l.value.map(d=>d.id);y.value=(r.data||[]).filter(d=>c.includes(d.encuesta_id))}catch(o){console.error("Error cargando datos:",o)}finally{C.value=!1}},u=(o,s)=>o===0?0:Math.round(s/o*100),k=o=>o?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"-",A=o=>o>=80?"text-green-600":o>=60?"text-blue-600":o>=40?"text-orange-600":"text-red-600",P=o=>o>=80?"bg-green-500":o>=60?"bg-blue-500":o>=40?"bg-orange-500":"bg-red-500",V=o=>o>=80?"border-green-200 bg-green-50/50":o>=60?"border-blue-200 bg-blue-50/50":o>=40?"border-orange-200 bg-orange-50/50":"border-red-200 bg-red-50/50";return(o,s)=>(i(),n("div",Q,[e("div",W,[e("div",X,[s[19]||(s[19]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Panel de Participación"),e("p",{class:"text-gray-600 mt-2"},"Monitorea en tiempo real el avance de las encuestas y la tasa de respuesta por área")],-1)),C.value?(i(),n("div",Y,s[0]||(s[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"},null,-1)]))):(i(),n(b,{key:1},[e("div",Z,[e("div",ee,[e("div",se,[e("div",null,[s[1]||(s[1]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Tasa Promedio",-1)),e("p",te,a(v.value.tasaPromedio)+"%",1),s[2]||(s[2]=e("p",{class:"text-xs text-gray-500 mt-1"},"En todas las encuestas",-1))]),e("div",oe,[m(g(H),{class:"h-7 w-7 text-indigo-600"})])])]),e("div",re,[e("div",ae,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Total Respuestas",-1)),e("p",ne,a(v.value.totalRespondidos),1),e("p",ie,"de "+a(v.value.totalEnviados)+" posibles",1)]),e("div",de,[m(g(U),{class:"h-7 w-7 text-green-600"})])])]),e("div",le,[e("div",ce,[e("div",null,[s[4]||(s[4]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Encuestas Activas",-1)),e("p",ue,a(v.value.encuestasActivas),1),s[5]||(s[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"En curso",-1))]),e("div",me,[m(g(F),{class:"h-7 w-7 text-blue-600"})])])]),e("div",ge,[e("div",pe,[e("div",null,[s[6]||(s[6]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Total Encuestas",-1)),e("p",xe,a(v.value.totalEncuestas),1),e("p",ve,a(v.value.encuestasCerradas)+" cerradas",1)]),e("div",fe,[m(g(S),{class:"h-7 w-7 text-gray-600"})])])])]),l.value.length===0?(i(),n("div",he,[m(g(S),{class:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s[7]||(s[7]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay encuestas aún",-1)),s[8]||(s[8]=e("p",{class:"text-gray-500"},"Crea encuestas para empezar a monitorear la participación de tu equipo.",-1))])):(i(),n(b,{key:1},[e("div",be,[e("div",_e,[e("div",ye,[m(g(G),{class:"h-5 w-5 text-white"})]),s[9]||(s[9]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Evolución de Participación"),e("p",{class:"text-sm text-gray-600"},"Histórico de tasas de respuesta por encuesta")],-1))]),e("div",we,[(i(!0),n(b,null,D(I.value,t=>(i(),n("div",{key:t.encuesta,class:"flex items-center gap-4"},[e("div",je,[e("p",Ee,a(k(t.fecha)),1)]),e("div",Ce,[e("div",ke,[e("p",Ae,a(t.encuesta),1),e("span",{class:x(["text-sm font-bold",A(t.tasa)])},a(t.tasa)+"% ",3)]),e("div",Pe,[e("div",{class:x(["h-3 rounded-full transition-all duration-500",P(t.tasa)]),style:z({width:`${t.tasa}%`})},null,6)]),e("p",Te,a(t.respondidos)+"/"+a(t.enviados)+" empleados",1)])]))),128))])]),e("div",De,[e("div",Re,[e("div",ze,[m(g(F),{class:"h-5 w-5 text-white"})]),s[10]||(s[10]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Participación por Departamento"),e("p",{class:"text-sm text-gray-600"},"Detalle de respuestas por área organizacional")],-1))]),e("div",Be,[(i(!0),n(b,null,D(M.value,t=>(i(),n("div",{key:t.id,class:x(["border rounded-xl p-6",V(u(t.enviados,t.respondidos))])},[e("div",Me,[e("div",qe,[e("h3",Fe,a(t.titulo),1),e("p",Se,[_(" Enviada: "+a(k(t.fecha_envio))+" ",1),t.fecha_cierre?(i(),n("span",Ie," • Cierre: "+a(k(t.fecha_cierre)),1)):R("",!0)])]),e("div",Ne,[e("p",{class:x(["text-3xl font-bold",A(u(t.enviados,t.respondidos))])},a(u(t.enviados,t.respondidos))+"% ",3),e("p",Ve,a(t.respondidos)+"/"+a(t.enviados),1)])]),e("div",Le,[e("div",$e,[e("div",{class:x(["h-3 rounded-full transition-all duration-500",P(u(t.enviados,t.respondidos))]),style:z({width:`${u(t.enviados,t.respondidos)}%`})},null,6)])]),t.departamentos.length>0?(i(),n("div",He,[(i(!0),n(b,null,D(t.departamentos,r=>(i(),n("div",{key:r.nombre,class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},[e("p",Ue,a(r.nombre),1),e("div",Ge,[e("p",{class:x(["text-lg font-bold",A(u(r.enviados,r.respondidos))])},a(u(r.enviados,r.respondidos))+"% ",3),e("p",Je,a(r.respondidos)+"/"+a(r.enviados),1)]),e("div",Ke,[e("div",{class:x(["h-1.5 rounded-full transition-all",P(u(r.enviados,r.respondidos))]),style:z({width:`${u(r.enviados,r.respondidos)}%`})},null,6)])]))),128))])):R("",!0)],2))),128))])]),f.value.mejor.nombre!=="-"?(i(),n("div",Oe,[e("div",Qe,[e("div",We,[e("div",Xe,[m(g(J),{class:"h-6 w-6 text-white"})]),e("div",null,[s[13]||(s[13]=e("h3",{class:"text-lg font-bold text-green-900 mb-2"},"Mejor Participación",-1)),e("p",Ye,[e("strong",null,a(f.value.mejor.nombre),1),s[11]||(s[11]=_(" lidera con una tasa de ")),e("strong",null,a(f.value.mejor.tasa)+"%",1),s[12]||(s[12]=_(" de participación. "))]),s[14]||(s[14]=e("p",{class:"text-xs text-green-700"}," ¡Excelente compromiso! Considera compartir sus prácticas con otros departamentos. ",-1))])])]),e("div",Ze,[e("div",es,[e("div",ss,[m(g(K),{class:"h-6 w-6 text-white"})]),e("div",null,[s[17]||(s[17]=e("h3",{class:"text-lg font-bold text-orange-900 mb-2"},"Requiere Atención",-1)),e("p",ts,[e("strong",null,a(f.value.peor.nombre),1),s[15]||(s[15]=_(" tiene una tasa de ")),e("strong",null,a(f.value.peor.tasa)+"%",1),s[16]||(s[16]=_(" de participación. "))]),s[18]||(s[18]=e("p",{class:"text-xs text-orange-700"}," Considera enviar recordatorios personalizados o investigar posibles barreras de participación. ",-1))])])])])):R("",!0)],64))],64))])])]))}};export{ls as default};

import{O as F,W as G,b as H,l as h,n as W,o as X,d as n,i as l,e as a,w as p,$ as v,f as u,t as f,D as J,z as g,C as w,B as C,E as q,F as B,r as D,h as k,p as K,q as Q,a0 as Y,j as i,k as b,A as Z,R as I,U as V,g as ee}from"./index-9XWXAznh.js";import{_ as ae}from"./Header-CQM0Mtxj.js";import{A as te}from"./arrow-left-Q60brOqV.js";import{H as se}from"./help-circle-BHYMPTC1.js";import{T as oe}from"./trash-2-CjVyO1Nz.js";import{X as M}from"./x-BqrVQl_H.js";import{S as le}from"./save-YtNVuqqx.js";const re={class:"min-h-screen bg-gray-50"},ie={class:"py-8"},ne={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},de={class:"mb-8"},ue={class:"flex items-center justify-between"},ce={key:0,class:"bg-white rounded-lg shadow-sm p-8 text-center"},pe={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},ve={class:"text-red-600 mb-4"},me={key:2,class:"bg-white rounded-lg shadow-sm overflow-hidden"},ge={class:"p-6 border-b border-gray-200"},be={class:"space-y-6"},fe={class:"form-group"},_e=["disabled"],ye={class:"form-group"},xe=["disabled"],he={class:"form-group"},we=["disabled"],Ee={class:"form-group"},Ce=["disabled"],ke={class:"p-6"},Ve={class:"flex items-center justify-between mb-6"},Pe={class:"text-xl font-semibold text-gray-900"},Se={key:0,class:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg"},Ae={key:1,class:"space-y-6"},$e={class:"flex items-start justify-between mb-4"},Ue={class:"text-lg font-medium text-gray-900"},Te={class:"form-group mb-4"},qe=["for"],Be=["id","onUpdate:modelValue","disabled"],De={class:"form-group mb-4"},Me=["for"],Oe=["id","onUpdate:modelValue","disabled","onChange"],Ne={key:0,class:"form-group"},je={class:"space-y-3"},ze=["onUpdate:modelValue","placeholder","disabled"],Le={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},Re={class:"flex justify-between items-center"},Fe={class:"text-sm text-gray-500"},Ge={key:0},He={key:1},We={class:"flex space-x-4"},Xe={__name:"EditarEncuestaView",setup(Je){const O=K(),P=Q(),y=G();H();const t=h(null),E=h(!0),x=h(null),r=h(!1),S=W(()=>{var s;return t.value&&((s=t.value.titulo)==null?void 0:s.trim())&&t.value.preguntas&&t.value.preguntas.length>0&&t.value.preguntas.every(e=>{var d;return((d=e.texto)==null?void 0:d.trim())&&e.tipo&&(e.tipo!=="opcion_multiple"||e.opciones&&e.opciones.every(o=>o==null?void 0:o.trim()))})}),A=async()=>{E.value=!0,x.value=null;try{const s=O.params.encuestaId,e=await Y(s);t.value={id:e.id,titulo:e.titulo||"",descripcion:e.descripcion||"",categoria:e.categoria||"general",estado:e.estado||"borrador",preguntas:e.preguntas||[]},t.value.preguntas=t.value.preguntas.map(d=>({id:d.id||Date.now()+Math.random(),texto:d.texto||"",tipo:d.tipo||"",opciones:d.opciones||(d.tipo==="opcion_multiple"?["",""]:[])}))}catch(s){x.value=s.message||"Error al cargar la encuesta",console.error("Error cargando encuesta:",s)}finally{E.value=!1}},$=()=>{P.push("/admin/encuestas")},N=async()=>{if(!S.value){y.add({severity:"warn",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}r.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),y.add({severity:"success",summary:"¡Cambios guardados!",detail:"La encuesta ha sido actualizada correctamente",life:4e3}),P.push("/admin/encuestas")}catch(s){console.error("Error al guardar cambios:",s),y.add({severity:"error",summary:"Error al guardar",detail:s.message||"No se pudieron guardar los cambios",life:5e3})}finally{r.value=!1}},U=()=>{t.value.preguntas||(t.value.preguntas=[]);const s={id:Date.now()+Math.random(),texto:"",tipo:"",opciones:[]};t.value.preguntas.push(s)},j=s=>{t.value.preguntas.splice(s,1),y.add({severity:"info",summary:"Pregunta eliminada",detail:"La pregunta ha sido removida de la encuesta",life:3e3})},z=s=>{const e=t.value.preguntas[s];e.tipo==="opcion_multiple"?(!e.opciones||e.opciones.length===0)&&(e.opciones=["",""]):e.opciones=[]},L=s=>{t.value.preguntas[s].opciones||(t.value.preguntas[s].opciones=[]),t.value.preguntas[s].opciones.push("")},R=(s,e)=>{t.value.preguntas[s].opciones.splice(e,1)};return X(()=>{A()}),(s,e)=>{var d;return i(),n("div",re,[l(ae,{subtitulo:"Editar Encuesta"}),a("div",ie,[a("div",ne,[a("div",de,[a("div",ue,[e[5]||(e[5]=a("div",null,[a("h1",{class:"text-3xl font-bold text-gray-900"},"Editar Encuesta"),a("p",{class:"mt-2 text-lg text-gray-600"},"Modifica los detalles de la encuesta existente")],-1)),l(v,{onClick:$,variant:"outline"},{default:p(()=>[l(u(te),{class:"h-5 w-5 mr-2"}),e[4]||(e[4]=b(" Volver a Encuestas "))]),_:1,__:[4]})])]),E.value?(i(),n("div",ce,e[6]||(e[6]=[a("div",{class:"animate-spin rounded-full h-12 w-12 border-2 border-primary border-t-transparent mx-auto mb-4"},null,-1),a("p",{class:"text-gray-600"},"Cargando encuesta...",-1)]))):x.value?(i(),n("div",pe,[l(u(Z),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),e[8]||(e[8]=a("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar la encuesta",-1)),a("p",ve,f(x.value),1),l(v,{onClick:A,variant:"outline"},{default:p(()=>[l(u(I),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=b(" Reintentar "))]),_:1,__:[7]})])):t.value?(i(),n("div",me,[a("form",{onSubmit:J(N,["prevent"]),class:"space-y-8"},[a("div",ge,[e[17]||(e[17]=a("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Información Básica",-1)),a("div",be,[a("div",fe,[e[9]||(e[9]=a("label",{for:"titulo",class:"form-label"}," Título de la Encuesta * ",-1)),g(a("input",{id:"titulo","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.titulo=o),type:"text",class:"input",placeholder:"Ej: Encuesta de Satisfacción Laboral",required:"",disabled:r.value},null,8,_e),[[w,t.value.titulo]])]),a("div",ye,[e[10]||(e[10]=a("label",{for:"descripcion",class:"form-label"}," Descripción (Opcional) ",-1)),g(a("textarea",{id:"descripcion","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.descripcion=o),rows:"3",class:"input",placeholder:"Describe brevemente el propósito de esta encuesta...",disabled:r.value},null,8,xe),[[w,t.value.descripcion]])]),a("div",he,[e[12]||(e[12]=a("label",{for:"categoria",class:"form-label"}," Categoría de la Encuesta * ",-1)),g(a("select",{id:"categoria","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.categoria=o),class:"input",required:"",disabled:r.value},e[11]||(e[11]=[q('<option value="" data-v-e09f0898>Selecciona una categoría</option><option value="salud-mental" data-v-e09f0898>🧠 Salud Mental</option><option value="carga-laboral" data-v-e09f0898>⚖️ Carga Laboral</option><option value="comunicacion" data-v-e09f0898>💬 Comunicación</option><option value="ergonomia" data-v-e09f0898>🪑 Ergonomía</option><option value="desarrollo" data-v-e09f0898>📈 Desarrollo Profesional</option><option value="general" data-v-e09f0898>📊 Bienestar General</option>',7)]),8,we),[[C,t.value.categoria]]),e[13]||(e[13]=a("p",{class:"mt-1 text-sm text-gray-500"}," Esta categoría ayuda a clasificar y analizar los resultados ",-1))]),a("div",Ee,[e[15]||(e[15]=a("label",{for:"estado",class:"form-label"}," Estado de la Encuesta * ",-1)),g(a("select",{id:"estado","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.estado=o),class:"input",required:"",disabled:r.value},e[14]||(e[14]=[a("option",{value:"borrador"},"Borrador",-1),a("option",{value:"activa"},"Activa",-1),a("option",{value:"finalizada"},"Finalizada",-1),a("option",{value:"pausada"},"Pausada",-1)]),8,Ce),[[C,t.value.estado]]),e[16]||(e[16]=a("p",{class:"mt-1 text-sm text-gray-500"}," Solo las encuestas activas son visibles para los empleados ",-1))])])]),a("div",ke,[a("div",Ve,[a("h2",Pe," Preguntas ("+f(((d=t.value.preguntas)==null?void 0:d.length)||0)+") ",1),l(v,{type:"button",onClick:U,variant:"outline",disabled:r.value},{default:p(()=>[l(u(V),{class:"h-5 w-5 mr-2"}),e[18]||(e[18]=b(" Añadir Pregunta "))]),_:1,__:[18]},8,["disabled"])]),!t.value.preguntas||t.value.preguntas.length===0?(i(),n("div",Se,[l(u(se),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[20]||(e[20]=a("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay preguntas",-1)),e[21]||(e[21]=a("p",{class:"text-gray-500 mb-4"},"Esta encuesta no tiene preguntas configuradas",-1)),l(v,{type:"button",onClick:U,disabled:r.value},{default:p(()=>[l(u(V),{class:"h-5 w-5 mr-2"}),e[19]||(e[19]=b(" Añadir Primera Pregunta "))]),_:1,__:[19]},8,["disabled"])])):(i(),n("div",Ae,[(i(!0),n(B,null,D(t.value.preguntas,(o,c)=>(i(),n("div",{key:o.id||c,class:"border border-gray-200 rounded-lg p-6 bg-gray-50"},[a("div",$e,[a("h3",Ue," Pregunta "+f(c+1),1),l(v,{type:"button",onClick:m=>j(c),variant:"outline",class:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:r.value},{default:p(()=>[l(u(oe),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])]),a("div",Te,[a("label",{for:`pregunta-texto-${c}`,class:"form-label"}," Texto de la Pregunta * ",8,qe),g(a("textarea",{id:`pregunta-texto-${c}`,"onUpdate:modelValue":m=>o.texto=m,rows:"2",class:"input",placeholder:"Escribe tu pregunta aquí...",required:"",disabled:r.value},null,8,Be),[[w,o.texto]])]),a("div",De,[a("label",{for:`pregunta-tipo-${c}`,class:"form-label"}," Tipo de Pregunta * ",8,Me),g(a("select",{id:`pregunta-tipo-${c}`,"onUpdate:modelValue":m=>o.tipo=m,class:"input",required:"",disabled:r.value,onChange:m=>z(c)},e[22]||(e[22]=[q('<option value="" data-v-e09f0898>Selecciona un tipo</option><option value="opcion_multiple" data-v-e09f0898>Opción Múltiple</option><option value="si_no" data-v-e09f0898>Sí / No</option><option value="escala_1_5" data-v-e09f0898>Escala 1-5</option><option value="texto_abierto" data-v-e09f0898>Texto Abierto (Anónimo)</option>',5)]),40,Oe),[[C,o.tipo]])]),o.tipo==="opcion_multiple"?(i(),n("div",Ne,[e[24]||(e[24]=a("label",{class:"form-label"},"Opciones de Respuesta *",-1)),a("div",je,[(i(!0),n(B,null,D(o.opciones,(m,_)=>(i(),n("div",{key:_,class:"flex items-center space-x-3"},[g(a("input",{"onUpdate:modelValue":T=>o.opciones[_]=T,type:"text",class:"input flex-1",placeholder:`Opción ${_+1}`,required:"",disabled:r.value},null,8,ze),[[w,o.opciones[_]]]),o.opciones.length>2?(i(),ee(v,{key:0,type:"button",onClick:T=>R(c,_),variant:"outline",class:"text-red-600 hover:text-red-700",disabled:r.value},{default:p(()=>[l(u(M),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])):k("",!0)]))),128)),l(v,{type:"button",onClick:m=>L(c),variant:"outline",class:"w-full",disabled:r.value},{default:p(()=>[l(u(V),{class:"h-4 w-4 mr-2"}),e[23]||(e[23]=b(" Agregar Opción "))]),_:2,__:[23]},1032,["onClick","disabled"])])])):k("",!0)]))),128))]))]),a("div",Le,[a("div",Re,[a("div",Fe,[!t.value.preguntas||t.value.preguntas.length===0?(i(),n("span",Ge," Agrega al menos una pregunta para activar la encuesta ")):(i(),n("span",He,f(t.value.preguntas.length)+" pregunta"+f(t.value.preguntas.length!==1?"s":"")+" configurada"+f(t.value.preguntas.length!==1?"s":""),1))]),a("div",We,[l(v,{type:"button",onClick:$,variant:"outline",disabled:r.value},{default:p(()=>[l(u(M),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=b(" Cancelar "))]),_:1,__:[25]},8,["disabled"]),l(v,{type:"submit",loading:r.value,disabled:!S.value},{default:p(()=>[l(u(le),{class:"h-4 w-4 mr-2"}),e[26]||(e[26]=b(" Guardar Cambios "))]),_:1,__:[26]},8,["loading","disabled"])])])])],32)])):k("",!0)])])])}}},ta=F(Xe,[["__scopeId","data-v-e09f0898"]]);export{ta as default};

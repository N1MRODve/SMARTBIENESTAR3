import{A as H,d as p,N as $,B as L,f as O,h as u,j as e,v as d,u as S,z as n,t as c,F as B,y as F,D as J,o as v,I as w,E as K,b as D,q as f,H as x,L as Q,G as W}from"./vue-vendor-DLSXyIw7.js";import{d as X,e as Y,f as Z,h as z,A as ee,R as se,o as U}from"./index-D33O_vwf.js";import{g as ae,a as oe,b as re,c as le,r as te,d as ie,e as ne}from"./sesiones.service-C7c0RVw4.js";import{s as de}from"./dialog.esm-C9zKQD4N.js";import{A as ue}from"./arrow-left-DGT1lY9t.js";import{P as ce}from"./plus-n9pYVzkT.js";import"./supabase-B7V2753y.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=X("UserIcon",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),me=H("sesiones",()=>{const g=p([]),I=p([]),h=p([]),E=p(null),l=p(!1),t=p(null);return{sesiones:g,serviciosSolicitados:I,sesionesEmpleado:h,sesionSeleccionada:E,loading:l,error:t,cargarSesiones:async()=>{l.value=!0,t.value=null;try{const r=await ae();g.value=r}catch(r){t.value=r.message||"Error al cargar las sesiones",console.error("Error cargando sesiones:",r)}finally{l.value=!1}},cargarServiciosSolicitados:async()=>{l.value=!0,t.value=null;try{const r=await oe();I.value=r}catch(r){t.value=r.message||"Error al cargar los servicios solicitados",console.error("Error cargando servicios solicitados:",r)}finally{l.value=!1}},cargarSesionesEmpleado:async r=>{l.value=!0,t.value=null;try{const a=await re(r);h.value=a}catch(a){t.value=a.message||"Error al cargar las sesiones del empleado",console.error("Error cargando sesiones del empleado:",a)}finally{l.value=!1}},crearSesion:async r=>{l.value=!0,t.value=null;try{const a=await le(r);if(a.success)return g.value.push(a.sesion),console.log("Sesión creada exitosamente:",a.sesion),{success:!0,sesion:a.sesion}}catch(a){throw t.value=a.message||"Error al crear la sesión",console.error("Error creando sesión:",a),a}finally{l.value=!1}},reservarPlazaSesion:async(r,a)=>{l.value=!0,t.value=null;try{const i=await te(r,a);if(i.success){const b=g.value.findIndex(k=>k.id===parseInt(r));return b!==-1&&(g.value[b]=i.sesion),console.log("Plaza reservada exitosamente"),{success:!0,plazasDisponibles:i.plazasDisponibles}}}catch(i){throw t.value=i.message||"Error al reservar la plaza",console.error("Error reservando plaza:",i),i}finally{l.value=!1}},cancelarReservaSesion:async(r,a)=>{l.value=!0,t.value=null;try{const i=await ie(r,a);if(i.success){const b=g.value.findIndex(k=>k.id===parseInt(r));return b!==-1&&(g.value[b]=i.sesion),console.log("Reserva cancelada exitosamente"),{success:!0,plazasDisponibles:i.plazasDisponibles}}}catch(i){throw t.value=i.message||"Error al cancelar la reserva",console.error("Error cancelando reserva:",i),i}finally{l.value=!1}},cargarSesionPorId:async r=>{l.value=!0,t.value=null;try{const a=await ne(r);E.value=a}catch(a){t.value=a.message||"Error al cargar la sesión",console.error("Error cargando sesión por ID:",a)}finally{l.value=!1}}}}),pe={class:"min-h-screen bg-gray-50"},fe={class:"py-8"},ge={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},be={class:"mb-8"},ye={class:"flex justify-between items-center"},xe={key:0,class:"bg-white rounded-lg shadow-sm p-8 text-center"},Se={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},he={class:"text-red-600 mb-4"},_e={key:2,class:"bg-white rounded-lg shadow-sm p-12 text-center"},we={key:3,class:"space-y-6"},Ee={class:"bg-gray-50 px-6 py-4 border-b border-gray-200"},Pe={class:"flex justify-between items-start"},ke={class:"flex-1"},ze={class:"text-lg font-semibold text-gray-900 mb-2"},Ie={class:"flex items-center space-x-4 text-sm text-gray-500"},De={class:"flex items-center"},Ve={class:"flex items-center"},Te={class:"p-6"},Ce={class:"flex justify-between items-start"},Ue={class:"flex-1"},Me={key:0,class:"text-gray-600 mb-4"},Ne={key:1,class:"mb-4"},qe={class:"space-y-2"},Re={class:"font-medium text-blue-900"},je={class:"text-sm text-blue-700"},Ae={class:"text-right"},Le={class:"text-sm font-medium text-blue-900"},Be={class:"text-xs text-blue-600"},Fe={class:"ml-6"},Ge={key:0,class:"space-y-6"},He={class:"p-4 bg-blue-50 rounded-lg border border-blue-200"},$e={class:"font-medium text-blue-900 mb-1"},Oe={class:"form-group"},Je={class:"form-group"},Ke={class:"grid grid-cols-2 gap-4"},Qe={class:"form-group"},We=["min"],Xe={class:"form-group"},Ye={class:"grid grid-cols-2 gap-4"},Ze={class:"form-group"},es={class:"form-group"},ss={class:"form-group"},as={key:0,class:"form-group"},os={class:"form-group"},rs={class:"flex justify-end space-x-4"},ls={__name:"GestionServiciosView",setup(g){const I=J(),h=Z(),E=me(),{serviciosSolicitados:l,sesiones:t,loading:M,error:V}=$(E),{cargarServiciosSolicitados:T,cargarSesiones:C,crearSesion:N}=E,P=p(!1),_=p(null),r=p(!1),a=p({titulo:"",descripcion:"",fecha:"",hora:"",duracion:60,plazasTotales:10,modalidad:"",ubicacion:"",instructor:""}),i=L(()=>new Date().toISOString().split("T")[0]),b=L(()=>a.value.titulo.trim()&&a.value.fecha&&a.value.hora&&a.value.duracion>0&&a.value.plazasTotales>0&&a.value.modalidad&&(a.value.modalidad==="virtual"||a.value.ubicacion.trim())),k=()=>{I.push("/admin/dashboard")},q=m=>new Date(m).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),R=m=>t.value.filter(s=>s.servicioId===m),G=m=>{_.value=m,a.value.titulo=`${m.servicioTitulo} - Nueva Sesión`,a.value.servicioId=m.servicioId,P.value=!0},j=()=>{P.value=!1,_.value=null,a.value={titulo:"",descripcion:"",fecha:"",hora:"",duracion:60,plazasTotales:10,modalidad:"",ubicacion:"",instructor:""}},A=async()=>{if(!b.value){h.add({severity:"warn",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}r.value=!0;try{await N({...a.value,servicioId:_.value.servicioId}),h.add({severity:"success",summary:"¡Sesión programada!",detail:"La sesión ha sido creada y estará disponible para reservas",life:5e3}),j(),await C()}catch(m){console.error("Error al crear sesión:",m),h.add({severity:"error",summary:"Error al programar",detail:m.message||"No se pudo crear la sesión",life:5e3})}finally{r.value=!1}};return O(async()=>{await T(),await C()}),(m,s)=>(v(),u("div",pe,[e("div",fe,[e("div",ge,[e("div",be,[e("div",ye,[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Gestión de Servicios"),e("p",{class:"mt-2 text-lg text-gray-600"},"Programa sesiones para los servicios solicitados")],-1)),d(z,{onClick:k,variant:"outline"},{default:S(()=>[d(n(ue),{class:"h-5 w-5 mr-2"}),s[10]||(s[10]=w(" Volver al Dashboard "))]),_:1,__:[10]})])]),n(M)?(v(),u("div",xe,s[12]||(s[12]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-2 border-primary border-t-transparent mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"Cargando servicios solicitados...",-1)]))):n(V)?(v(),u("div",Se,[d(n(ee),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),s[14]||(s[14]=e("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar los servicios",-1)),e("p",he,c(n(V)),1),d(z,{onClick:n(T),variant:"outline"},{default:S(()=>[d(n(se),{class:"h-4 w-4 mr-2"}),s[13]||(s[13]=w(" Reintentar "))]),_:1,__:[13]},8,["onClick"])])):n(l).length===0?(v(),u("div",_e,[d(n(U),{class:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s[15]||(s[15]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay servicios solicitados",-1)),s[16]||(s[16]=e("p",{class:"text-gray-500 mb-6"},"Los servicios aparecerán aquí cuando sean solicitados desde los resultados de encuestas",-1))])):(v(),u("div",we,[(v(!0),u(B,null,F(n(l),o=>(v(),u("div",{key:o.id,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},[e("div",Ee,[e("div",Pe,[e("div",ke,[e("h3",ze,c(o.servicioTitulo),1),e("div",Ie,[e("div",De,[d(n(U),{class:"h-4 w-4 mr-1"}),e("span",null,"Solicitado el "+c(q(o.fechaSolicitud)),1)]),e("div",Ve,[d(n(ve),{class:"h-4 w-4 mr-1"}),e("span",null,"Por "+c(o.solicitadoPor),1)])])]),e("span",{class:K(["px-3 py-1 rounded-full text-xs font-medium",o.estado==="aprobado"?"bg-green-100 text-green-800":o.estado==="pendiente"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},c(o.estado==="aprobado"?"Aprobado":o.estado==="pendiente"?"Pendiente":o.estado),3)])]),e("div",Te,[e("div",Ce,[e("div",Ue,[o.notas?(v(),u("p",Me,[s[17]||(s[17]=e("strong",null,"Notas:",-1)),w(" "+c(o.notas),1)])):D("",!0),R(o.servicioId).length>0?(v(),u("div",Ne,[s[18]||(s[18]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Sesiones Programadas:",-1)),e("div",qe,[(v(!0),u(B,null,F(R(o.servicioId),y=>(v(),u("div",{key:y.id,class:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200"},[e("div",null,[e("p",Re,c(y.titulo),1),e("p",je,c(q(y.fecha))+" a las "+c(y.hora),1)]),e("div",Ae,[e("p",Le,c(y.participantes.length)+"/"+c(y.plazasTotales)+" plazas ",1),e("p",Be,c(y.modalidad),1)])]))),128))])])):D("",!0)]),e("div",Fe,[d(z,{onClick:y=>G(o),disabled:o.estado!=="aprobado"},{default:S(()=>[d(n(ce),{class:"h-4 w-4 mr-2"}),s[19]||(s[19]=w(" Programar Sesión "))]),_:2,__:[19]},1032,["onClick","disabled"])])])])]))),128))]))])]),d(n(de),{visible:P.value,"onUpdate:visible":s[9]||(s[9]=o=>P.value=o),modal:"",header:"Programar Nueva Sesión",style:{width:"600px"}},{footer:S(()=>[e("div",rs,[d(z,{onClick:j,variant:"outline",disabled:r.value},{default:S(()=>s[31]||(s[31]=[w(" Cancelar ")])),_:1,__:[31]},8,["disabled"]),d(z,{onClick:A,loading:r.value,disabled:!b.value},{default:S(()=>[d(n(U),{class:"h-4 w-4 mr-2"}),s[32]||(s[32]=w(" Programar Sesión "))]),_:1,__:[32]},8,["loading","disabled"])])]),default:S(()=>[_.value?(v(),u("div",Ge,[e("div",He,[e("h4",$e,c(_.value.servicioTitulo),1),s[20]||(s[20]=e("p",{class:"text-sm text-blue-700"},"Programando nueva sesión para este servicio",-1))]),e("form",{onSubmit:W(A,["prevent"]),class:"space-y-4"},[e("div",Oe,[s[21]||(s[21]=e("label",{for:"titulo",class:"form-label"},"Título de la Sesión *",-1)),f(e("input",{id:"titulo","onUpdate:modelValue":s[0]||(s[0]=o=>a.value.titulo=o),type:"text",class:"input",placeholder:"Ej: Taller de Mindfulness - Sesión Matutina",required:""},null,512),[[x,a.value.titulo]])]),e("div",Je,[s[22]||(s[22]=e("label",{for:"descripcion",class:"form-label"},"Descripción",-1)),f(e("textarea",{id:"descripcion","onUpdate:modelValue":s[1]||(s[1]=o=>a.value.descripcion=o),rows:"3",class:"input",placeholder:"Descripción breve de la sesión..."},null,512),[[x,a.value.descripcion]])]),e("div",Ke,[e("div",Qe,[s[23]||(s[23]=e("label",{for:"fecha",class:"form-label"},"Fecha *",-1)),f(e("input",{id:"fecha","onUpdate:modelValue":s[2]||(s[2]=o=>a.value.fecha=o),type:"date",class:"input",min:i.value,required:""},null,8,We),[[x,a.value.fecha]])]),e("div",Xe,[s[24]||(s[24]=e("label",{for:"hora",class:"form-label"},"Hora *",-1)),f(e("input",{id:"hora","onUpdate:modelValue":s[3]||(s[3]=o=>a.value.hora=o),type:"time",class:"input",required:""},null,512),[[x,a.value.hora]])])]),e("div",Ye,[e("div",Ze,[s[25]||(s[25]=e("label",{for:"duracion",class:"form-label"},"Duración (minutos) *",-1)),f(e("input",{id:"duracion","onUpdate:modelValue":s[4]||(s[4]=o=>a.value.duracion=o),type:"number",class:"input",min:"30",max:"480",step:"15",required:""},null,512),[[x,a.value.duracion]])]),e("div",es,[s[26]||(s[26]=e("label",{for:"plazas",class:"form-label"},"Plazas Totales *",-1)),f(e("input",{id:"plazas","onUpdate:modelValue":s[5]||(s[5]=o=>a.value.plazasTotales=o),type:"number",class:"input",min:"1",max:"50",required:""},null,512),[[x,a.value.plazasTotales]])])]),e("div",ss,[s[28]||(s[28]=e("label",{for:"modalidad",class:"form-label"},"Modalidad *",-1)),f(e("select",{id:"modalidad","onUpdate:modelValue":s[6]||(s[6]=o=>a.value.modalidad=o),class:"input",required:""},s[27]||(s[27]=[e("option",{value:""},"Selecciona modalidad",-1),e("option",{value:"presencial"},"Presencial",-1),e("option",{value:"virtual"},"Virtual",-1),e("option",{value:"hibrida"},"Híbrida",-1)]),512),[[Q,a.value.modalidad]])]),a.value.modalidad==="presencial"||a.value.modalidad==="hibrida"?(v(),u("div",as,[s[29]||(s[29]=e("label",{for:"ubicacion",class:"form-label"},"Ubicación *",-1)),f(e("input",{id:"ubicacion","onUpdate:modelValue":s[7]||(s[7]=o=>a.value.ubicacion=o),type:"text",class:"input",placeholder:"Ej: Sala de Reuniones Principal",required:""},null,512),[[x,a.value.ubicacion]])])):D("",!0),e("div",os,[s[30]||(s[30]=e("label",{for:"instructor",class:"form-label"},"Instructor",-1)),f(e("input",{id:"instructor","onUpdate:modelValue":s[8]||(s[8]=o=>a.value.instructor=o),type:"text",class:"input",placeholder:"Nombre del instructor o especialista"},null,512),[[x,a.value.instructor]])])],32)])):D("",!0)]),_:1},8,["visible"])]))}},ms=Y(ls,[["__scopeId","data-v-15a80ca1"]]);export{ms as default};

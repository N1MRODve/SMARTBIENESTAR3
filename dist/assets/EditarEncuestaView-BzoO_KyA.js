import{d as h,B as G,f as F,h as n,j as a,v as l,u as p,z as u,t as b,G as H,q as f,H as w,L as E,K as q,F as B,y as D,b as k,U as K,D as X,o as i,I as g,c as I}from"./vue-vendor-DLSXyIw7.js";import{e as J,f as Q,b as W,h as v,A as Y,R as Z}from"./index-D33O_vwf.js";import{g as ee}from"./encuestas.service-DI5Iei12.js";import{A as ae}from"./arrow-left-DGT1lY9t.js";import{P}from"./plus-n9pYVzkT.js";import{H as te}from"./help-circle-Cgf4FoU8.js";import{T as se}from"./trash-2-OdR_kCZk.js";import{X as M}from"./x-qOn0wnZo.js";import{S as oe}from"./save-BO0ouwoH.js";import"./supabase-B7V2753y.js";const le={class:"min-h-screen bg-gray-50"},re={class:"py-8"},ie={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},ne={class:"mb-8"},de={class:"flex items-center justify-between"},ue={key:0,class:"bg-white rounded-lg shadow-sm p-8 text-center"},ce={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},pe={class:"text-red-600 mb-4"},ve={key:2,class:"bg-white rounded-lg shadow-sm overflow-hidden"},me={class:"p-6 border-b border-gray-200"},fe={class:"space-y-6"},ge={class:"form-group"},be=["disabled"],ye={class:"form-group"},_e=["disabled"],xe={class:"form-group"},he=["disabled"],we={class:"form-group"},Ce=["disabled"],Ee={class:"p-6"},ke={class:"flex items-center justify-between mb-6"},Pe={class:"text-xl font-semibold text-gray-900"},Ve={key:0,class:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg"},Se={key:1,class:"space-y-6"},Ae={class:"flex items-start justify-between mb-4"},Ue={class:"text-lg font-medium text-gray-900"},Te={class:"form-group mb-4"},$e=["for"],qe=["id","onUpdate:modelValue","disabled"],Be={class:"form-group mb-4"},De=["for"],Me=["id","onUpdate:modelValue","disabled","onChange"],Ne={key:0,class:"form-group"},Oe={class:"space-y-3"},Le=["onUpdate:modelValue","placeholder","disabled"],je={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},ze={class:"flex justify-between items-center"},Re={class:"text-sm text-gray-500"},Ge={key:0},Fe={key:1},He={class:"flex space-x-4"},Ke={__name:"EditarEncuestaView",setup(Xe){const N=K(),V=X(),_=Q();W();const t=h(null),C=h(!0),x=h(null),r=h(!1),S=G(()=>{var s;return t.value&&((s=t.value.titulo)==null?void 0:s.trim())&&t.value.preguntas&&t.value.preguntas.length>0&&t.value.preguntas.every(e=>{var d;return((d=e.texto)==null?void 0:d.trim())&&e.tipo&&(e.tipo!=="opcion_multiple"||e.opciones&&e.opciones.every(o=>o==null?void 0:o.trim()))})}),A=async()=>{C.value=!0,x.value=null;try{const s=N.params.encuestaId,e=await ee(s);t.value={id:e.id,titulo:e.titulo||"",descripcion:e.descripcion||"",categoria:e.categoria||"general",estado:e.estado||"borrador",preguntas:e.preguntas||[]},t.value.preguntas=t.value.preguntas.map(d=>({id:d.id||Date.now()+Math.random(),texto:d.texto||"",tipo:d.tipo||"",opciones:d.opciones||(d.tipo==="opcion_multiple"?["",""]:[])}))}catch(s){x.value=s.message||"Error al cargar la encuesta",console.error("Error cargando encuesta:",s)}finally{C.value=!1}},U=()=>{V.push("/admin/encuestas")},O=async()=>{if(!S.value){_.add({severity:"warn",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}r.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),_.add({severity:"success",summary:"춰Cambios guardados!",detail:"La encuesta ha sido actualizada correctamente",life:4e3}),V.push("/admin/encuestas")}catch(s){console.error("Error al guardar cambios:",s),_.add({severity:"error",summary:"Error al guardar",detail:s.message||"No se pudieron guardar los cambios",life:5e3})}finally{r.value=!1}},T=()=>{t.value.preguntas||(t.value.preguntas=[]);const s={id:Date.now()+Math.random(),texto:"",tipo:"",opciones:[]};t.value.preguntas.push(s)},L=s=>{t.value.preguntas.splice(s,1),_.add({severity:"info",summary:"Pregunta eliminada",detail:"La pregunta ha sido removida de la encuesta",life:3e3})},j=s=>{const e=t.value.preguntas[s];e.tipo==="opcion_multiple"?(!e.opciones||e.opciones.length===0)&&(e.opciones=["",""]):e.opciones=[]},z=s=>{t.value.preguntas[s].opciones||(t.value.preguntas[s].opciones=[]),t.value.preguntas[s].opciones.push("")},R=(s,e)=>{t.value.preguntas[s].opciones.splice(e,1)};return F(()=>{A()}),(s,e)=>{var d;return i(),n("div",le,[a("div",re,[a("div",ie,[a("div",ne,[a("div",de,[e[5]||(e[5]=a("div",null,[a("h1",{class:"text-3xl font-bold text-gray-900"},"Editar Encuesta"),a("p",{class:"mt-2 text-lg text-gray-600"},"Modifica los detalles de la encuesta existente")],-1)),l(v,{onClick:U,variant:"outline"},{default:p(()=>[l(u(ae),{class:"h-5 w-5 mr-2"}),e[4]||(e[4]=g(" Volver a Encuestas "))]),_:1,__:[4]})])]),C.value?(i(),n("div",ue,e[6]||(e[6]=[a("div",{class:"animate-spin rounded-full h-12 w-12 border-2 border-primary border-t-transparent mx-auto mb-4"},null,-1),a("p",{class:"text-gray-600"},"Cargando encuesta...",-1)]))):x.value?(i(),n("div",ce,[l(u(Y),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),e[8]||(e[8]=a("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar la encuesta",-1)),a("p",pe,b(x.value),1),l(v,{onClick:A,variant:"outline"},{default:p(()=>[l(u(Z),{class:"h-4 w-4 mr-2"}),e[7]||(e[7]=g(" Reintentar "))]),_:1,__:[7]})])):t.value?(i(),n("div",ve,[a("form",{onSubmit:H(O,["prevent"]),class:"space-y-8"},[a("div",me,[e[17]||(e[17]=a("h2",{class:"text-xl font-semibold text-gray-900 mb-6"},"Informaci칩n B치sica",-1)),a("div",fe,[a("div",ge,[e[9]||(e[9]=a("label",{for:"titulo",class:"form-label"}," T칤tulo de la Encuesta * ",-1)),f(a("input",{id:"titulo","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.titulo=o),type:"text",class:"input",placeholder:"Ej: Encuesta de Satisfacci칩n Laboral",required:"",disabled:r.value},null,8,be),[[w,t.value.titulo]])]),a("div",ye,[e[10]||(e[10]=a("label",{for:"descripcion",class:"form-label"}," Descripci칩n (Opcional) ",-1)),f(a("textarea",{id:"descripcion","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.descripcion=o),rows:"3",class:"input",placeholder:"Describe brevemente el prop칩sito de esta encuesta...",disabled:r.value},null,8,_e),[[w,t.value.descripcion]])]),a("div",xe,[e[12]||(e[12]=a("label",{for:"categoria",class:"form-label"}," Categor칤a de la Encuesta * ",-1)),f(a("select",{id:"categoria","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.categoria=o),class:"input",required:"",disabled:r.value},e[11]||(e[11]=[q('<option value="" data-v-f39904ff>Selecciona una categor칤a</option><option value="salud-mental" data-v-f39904ff>游 Salud Mental</option><option value="carga-laboral" data-v-f39904ff>丘뒲잺 Carga Laboral</option><option value="comunicacion" data-v-f39904ff>游눫 Comunicaci칩n</option><option value="ergonomia" data-v-f39904ff>游뿜 Ergonom칤a</option><option value="desarrollo" data-v-f39904ff>游늳 Desarrollo Profesional</option><option value="general" data-v-f39904ff>游늵 Bienestar General</option>',7)]),8,he),[[E,t.value.categoria]]),e[13]||(e[13]=a("p",{class:"mt-1 text-sm text-gray-500"}," Esta categor칤a ayuda a clasificar y analizar los resultados ",-1))]),a("div",we,[e[15]||(e[15]=a("label",{for:"estado",class:"form-label"}," Estado de la Encuesta * ",-1)),f(a("select",{id:"estado","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.estado=o),class:"input",required:"",disabled:r.value},e[14]||(e[14]=[a("option",{value:"borrador"},"Borrador",-1),a("option",{value:"activa"},"Activa",-1),a("option",{value:"finalizada"},"Finalizada",-1),a("option",{value:"pausada"},"Pausada",-1)]),8,Ce),[[E,t.value.estado]]),e[16]||(e[16]=a("p",{class:"mt-1 text-sm text-gray-500"}," Solo las encuestas activas son visibles para los empleados ",-1))])])]),a("div",Ee,[a("div",ke,[a("h2",Pe," Preguntas ("+b(((d=t.value.preguntas)==null?void 0:d.length)||0)+") ",1),l(v,{type:"button",onClick:T,variant:"outline",disabled:r.value},{default:p(()=>[l(u(P),{class:"h-5 w-5 mr-2"}),e[18]||(e[18]=g(" A침adir Pregunta "))]),_:1,__:[18]},8,["disabled"])]),!t.value.preguntas||t.value.preguntas.length===0?(i(),n("div",Ve,[l(u(te),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[20]||(e[20]=a("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay preguntas",-1)),e[21]||(e[21]=a("p",{class:"text-gray-500 mb-4"},"Esta encuesta no tiene preguntas configuradas",-1)),l(v,{type:"button",onClick:T,disabled:r.value},{default:p(()=>[l(u(P),{class:"h-5 w-5 mr-2"}),e[19]||(e[19]=g(" A침adir Primera Pregunta "))]),_:1,__:[19]},8,["disabled"])])):(i(),n("div",Se,[(i(!0),n(B,null,D(t.value.preguntas,(o,c)=>(i(),n("div",{key:o.id||c,class:"border border-gray-200 rounded-lg p-6 bg-gray-50"},[a("div",Ae,[a("h3",Ue," Pregunta "+b(c+1),1),l(v,{type:"button",onClick:m=>L(c),variant:"outline",class:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:r.value},{default:p(()=>[l(u(se),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])]),a("div",Te,[a("label",{for:`pregunta-texto-${c}`,class:"form-label"}," Texto de la Pregunta * ",8,$e),f(a("textarea",{id:`pregunta-texto-${c}`,"onUpdate:modelValue":m=>o.texto=m,rows:"2",class:"input",placeholder:"Escribe tu pregunta aqu칤...",required:"",disabled:r.value},null,8,qe),[[w,o.texto]])]),a("div",Be,[a("label",{for:`pregunta-tipo-${c}`,class:"form-label"}," Tipo de Pregunta * ",8,De),f(a("select",{id:`pregunta-tipo-${c}`,"onUpdate:modelValue":m=>o.tipo=m,class:"input",required:"",disabled:r.value,onChange:m=>j(c)},e[22]||(e[22]=[q('<option value="" data-v-f39904ff>Selecciona un tipo</option><option value="opcion_multiple" data-v-f39904ff>Opci칩n M칰ltiple</option><option value="si_no" data-v-f39904ff>S칤 / No</option><option value="escala_1_5" data-v-f39904ff>Escala 1-5</option><option value="texto_abierto" data-v-f39904ff>Texto Abierto (An칩nimo)</option>',5)]),40,Me),[[E,o.tipo]])]),o.tipo==="opcion_multiple"?(i(),n("div",Ne,[e[24]||(e[24]=a("label",{class:"form-label"},"Opciones de Respuesta *",-1)),a("div",Oe,[(i(!0),n(B,null,D(o.opciones,(m,y)=>(i(),n("div",{key:y,class:"flex items-center space-x-3"},[f(a("input",{"onUpdate:modelValue":$=>o.opciones[y]=$,type:"text",class:"input flex-1",placeholder:`Opci칩n ${y+1}`,required:"",disabled:r.value},null,8,Le),[[w,o.opciones[y]]]),o.opciones.length>2?(i(),I(v,{key:0,type:"button",onClick:$=>R(c,y),variant:"outline",class:"text-red-600 hover:text-red-700",disabled:r.value},{default:p(()=>[l(u(M),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])):k("",!0)]))),128)),l(v,{type:"button",onClick:m=>z(c),variant:"outline",class:"w-full",disabled:r.value},{default:p(()=>[l(u(P),{class:"h-4 w-4 mr-2"}),e[23]||(e[23]=g(" Agregar Opci칩n "))]),_:2,__:[23]},1032,["onClick","disabled"])])])):k("",!0)]))),128))]))]),a("div",je,[a("div",ze,[a("div",Re,[!t.value.preguntas||t.value.preguntas.length===0?(i(),n("span",Ge," Agrega al menos una pregunta para activar la encuesta ")):(i(),n("span",Fe,b(t.value.preguntas.length)+" pregunta"+b(t.value.preguntas.length!==1?"s":"")+" configurada"+b(t.value.preguntas.length!==1?"s":""),1))]),a("div",He,[l(v,{type:"button",onClick:U,variant:"outline",disabled:r.value},{default:p(()=>[l(u(M),{class:"h-4 w-4 mr-2"}),e[25]||(e[25]=g(" Cancelar "))]),_:1,__:[25]},8,["disabled"]),l(v,{type:"submit",loading:r.value,disabled:!S.value},{default:p(()=>[l(u(oe),{class:"h-4 w-4 mr-2"}),e[26]||(e[26]=g(" Guardar Cambios "))]),_:1,__:[26]},8,["loading","disabled"])])])])],32)])):k("",!0)])])])}}},oa=J(Ke,[["__scopeId","data-v-f39904ff"]]);export{oa as default};

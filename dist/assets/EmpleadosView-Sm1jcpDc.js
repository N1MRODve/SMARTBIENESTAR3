import{u as N,s as w,U as I}from"./index-D33O_vwf.js";import{_ as P}from"./EmptyState-mSYFNM8S.js";import{d as g,o as l,h as m,j as e,q as y,L as E,F as k,y as C,t as u,H as _,f as j,G as B,B as H,v as $,z as h,I as F,c as V,b as M,E as S}from"./vue-vendor-DLSXyIw7.js";import{P as L}from"./plus-n9pYVzkT.js";import{M as R}from"./mail-BlTou-j4.js";import"./supabase-B7V2753y.js";const G={class:"fixed inset-0 z-50 flex items-center justify-center"},O={class:"bg-white rounded-lg shadow-xl w-full max-w-md"},T={class:"border-b p-4 flex justify-between items-center"},J={class:"p-6"},K={class:"mb-4"},Q=["value"],W={class:"bg-gray-50 p-4 flex justify-end space-x-4"},X={__name:"InvitarEmpleadosModal",emits:["close","submit"],setup(f,{emit:v}){const d=v,c=g(""),r=g(""),b=["RRHH","Ventas","Marketing","Producción","Atención al Cliente","Desarrollo","Finanzas","Operaciones","Calidad","Administración"],x=()=>{const t=c.value.split(/[\n,]+/).map(o=>o.trim()).filter(o=>o);t.length>0&&d("submit",{emails:t,departamento:r.value})};return(t,o)=>(l(),m(k,null,[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:o[0]||(o[0]=i=>t.$emit("close"))}),e("div",G,[e("div",O,[e("div",T,[o[5]||(o[5]=e("h2",{class:"text-xl font-semibold"},"Invitar Nuevos Empleados",-1)),e("button",{onClick:o[1]||(o[1]=i=>t.$emit("close")),class:"text-gray-500 hover:text-gray-800"},"×")]),e("div",J,[e("div",K,[o[7]||(o[7]=e("label",{for:"departamento",class:"block text-sm font-medium text-gray-700 mb-2"}," Departamento ",-1)),y(e("select",{id:"departamento","onUpdate:modelValue":o[2]||(o[2]=i=>r.value=i),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary"},[o[6]||(o[6]=e("option",{value:""},"Seleccionar departamento",-1)),(l(),m(k,null,C(b,i=>e("option",{key:i,value:i},u(i),9,Q)),64))],512),[[E,r.value]])]),e("div",null,[o[8]||(o[8]=e("label",{for:"emails",class:"block text-sm font-medium text-gray-700 mb-2"}," Correos Electrónicos ",-1)),o[9]||(o[9]=e("p",{class:"text-sm text-gray-500 mb-4"}," Introduce uno o varios correos electrónicos, separados por comas o saltos de línea. ",-1)),y(e("textarea",{id:"emails","onUpdate:modelValue":o[3]||(o[3]=i=>c.value=i),rows:"5",placeholder:"empleado1@empresa.com, empleado2@empresa.com",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary"},null,512),[[_,c.value]])])]),e("div",W,[e("button",{onClick:o[4]||(o[4]=i=>t.$emit("close")),class:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors"}," Cancelar "),e("button",{onClick:x,class:"bg-primary text-white font-bold py-2 px-4 rounded-md hover:bg-primary-dark transition-colors"}," Enviar Invitaciones ")])])])],64))}},Y={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Z={class:"bg-white rounded-lg shadow-xl w-full max-w-md p-6"},ee={class:"mb-4"},te={class:"mb-4"},oe={class:"mb-4"},se=["value"],ae={class:"mb-4"},re={class:"mb-6"},ne={class:"flex justify-end gap-3"},le={__name:"EditarEmpleadoModal",props:{empleado:{type:Object,required:!0},departamentos:{type:Array,required:!0}},emits:["close","submit"],setup(f,{emit:v}){const d=f,c=v,r=g({nombre:"",email:"",departamento_id:"",cargo:"",estado:"Activo"});j(()=>{r.value={nombre:d.empleado.nombre,email:d.empleado.email,departamento_id:d.empleado.departamento_id,cargo:d.empleado.cargo||"",estado:d.empleado.estado||"Activo"}});const b=()=>{c("submit",r.value)};return(x,t)=>(l(),m("div",Y,[e("div",Z,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold mb-4 text-gray-800"},"Editar Empleado",-1)),e("form",{onSubmit:B(b,["prevent"])},[e("div",ee,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nombre ",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.value.nombre=o),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"},null,512),[[_,r.value.nombre]])]),e("div",te,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.value.email=o),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"},null,512),[[_,r.value.email]])]),e("div",oe,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Departamento ",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.departamento_id=o),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"},[t[8]||(t[8]=e("option",{value:""},"Seleccionar departamento",-1)),(l(!0),m(k,null,C(f.departamentos,o=>(l(),m("option",{key:o.id,value:o.id},u(o.nombre),9,se))),128))],512),[[E,r.value.departamento_id]])]),e("div",ae,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Cargo ",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.cargo=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"},null,512),[[_,r.value.cargo]])]),e("div",re,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Estado ",-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.value.estado=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900"},t[11]||(t[11]=[e("option",{value:"Activo"},"Activo",-1),e("option",{value:"Invitado"},"Invitado",-1),e("option",{value:"Inactivo"},"Inactivo",-1)]),512),[[E,r.value.estado]])]),e("div",ne,[e("button",{type:"button",onClick:t[5]||(t[5]=o=>x.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors"}," Cancelar "),t[13]||(t[13]=e("button",{type:"submit",class:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors"}," Guardar ",-1))])],32)])]))}},ie={class:"space-y-6"},de={class:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-xl p-8"},me={class:"flex items-center justify-between"},ue={class:"flex items-center space-x-4"},pe={class:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center"},ce={class:"text-white/80 mt-1"},be={key:0,class:"flex items-center justify-center py-12"},ge={key:1,class:"bg-white rounded-2xl shadow-lg border border-gray-100"},xe={key:2,class:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"},ve={class:"overflow-x-auto"},ye={class:"w-full"},fe={class:"divide-y divide-gray-200"},we={class:"px-6 py-4 whitespace-nowrap"},he={class:"flex items-center"},_e={class:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center"},ke={class:"text-white font-semibold text-sm"},$e={class:"ml-4"},Ee={class:"text-sm font-medium text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Ve={class:"px-6 py-4 whitespace-nowrap"},Me={key:1,class:"text-sm text-gray-400"},Se={class:"px-6 py-4 whitespace-nowrap"},je={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},qe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ue=["onClick"],He={__name:"EmpleadosView",setup(f){const v=N(),d=g([]),c=g([]),r=g(!0),b=g(!1),x=g(!1),t=g(null),o=H(()=>d.value.length>0);j(async()=>{await Promise.all([i(),q()])});const i=async()=>{r.value=!0;try{const{data:n,error:s}=await w.from("empleados").select(`
        *,
        departamentos(nombre)
      `).eq("empresa_id",v.empresaId).order("created_at",{ascending:!1});if(s)throw s;d.value=n.map(a=>{var p;return{...a,departamento:((p=a.departamentos)==null?void 0:p.nombre)||null}})}catch(n){console.error("Error cargando empleados:",n)}finally{r.value=!1}},q=async()=>{try{const{data:n,error:s}=await w.from("departamentos").select("*").eq("empresa_id",v.empresaId).order("nombre");if(s)throw s;c.value=n||[]}catch(n){console.error("Error cargando departamentos:",n)}},U=async n=>{try{const s=n.map(p=>({empresa_id:v.empresaId,nombre:p.nombre,email:p.email,departamento_id:p.departamento_id,cargo:p.cargo||"",estado:"Invitado",puntos:0,es_admin:!1})),{error:a}=await w.from("empleados").insert(s);if(a)throw a;await i(),b.value=!1}catch(s){console.error("Error invitando empleados:",s),alert("Error al invitar empleados. Por favor intenta de nuevo.")}},D=n=>{t.value=n,x.value=!0},z=async n=>{try{const{error:s}=await w.from("empleados").update({nombre:n.nombre,email:n.email,departamento_id:n.departamento_id,cargo:n.cargo,estado:n.estado}).eq("id",t.value.id);if(s)throw s;await i(),x.value=!1}catch(s){console.error("Error actualizando empleado:",s),alert("Error al actualizar empleado. Por favor intenta de nuevo.")}},A=n=>({RRHH:"bg-blue-100 text-blue-800",Tecnología:"bg-purple-100 text-purple-800",Ventas:"bg-green-100 text-green-800",Marketing:"bg-pink-100 text-pink-800",Operaciones:"bg-yellow-100 text-yellow-800",Finanzas:"bg-indigo-100 text-indigo-800"})[n]||"bg-gray-100 text-gray-800";return(n,s)=>(l(),m("div",ie,[e("div",de,[e("div",me,[e("div",ue,[e("div",pe,[$(h(I),{class:"h-8 w-8 text-white"})]),e("div",null,[s[4]||(s[4]=e("h1",{class:"text-3xl font-bold text-white"},"Gestión de Empleados",-1)),e("p",ce,u(d.value.length)+" empleado"+u(d.value.length!==1?"s":"")+" en tu organización ",1)])]),e("button",{onClick:s[0]||(s[0]=a=>b.value=!0),class:"bg-white text-blue-600 font-semibold py-3 px-6 rounded-xl hover:bg-blue-50 transition-all shadow-lg hover:shadow-xl flex items-center gap-2"},[$(h(L),{class:"h-5 w-5"}),s[5]||(s[5]=F(" Invitar Empleados "))])])]),r.value?(l(),m("div",be,s[6]||(s[6]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):o.value?(l(),m("div",xe,[e("div",ve,[e("table",ye,[s[7]||(s[7]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Nombre "),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Email "),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Cargo "),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Departamento "),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Estado "),e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Puntos "),e("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",fe,[(l(!0),m(k,null,C(d.value,a=>(l(),m("tr",{key:a.id,class:"hover:bg-gray-50 transition-colors"},[e("td",we,[e("div",he,[e("div",_e,[e("span",ke,u(a.nombre.split(" ").map(p=>p[0]).join("").slice(0,2).toUpperCase()),1)]),e("div",$e,[e("div",Ee,u(a.nombre),1)])])]),e("td",Ce,u(a.email),1),e("td",Ie,u(a.cargo||"-"),1),e("td",Ve,[a.departamento?(l(),m("span",{key:0,class:S([A(a.departamento),"px-3 py-1 text-xs font-medium rounded-full inline-block"])},u(a.departamento),3)):(l(),m("span",Me,"Sin asignar"))]),e("td",Se,[e("span",{class:S([{"bg-green-100 text-green-800":a.estado==="Activo","bg-yellow-100 text-yellow-800":a.estado==="Invitado","bg-gray-100 text-gray-800":a.estado==="Inactivo"},"px-3 py-1 text-xs font-medium rounded-full"])},u(a.estado),3)]),e("td",je,u(a.puntos||0),1),e("td",qe,[e("button",{onClick:p=>D(a),class:"text-blue-600 hover:text-blue-900 font-medium transition-colors"}," Editar ",8,Ue)])]))),128))])])])])):(l(),m("div",ge,[$(P,{icon:h(I),title:"No hay empleados aún",description:"Comienza invitando a los miembros de tu equipo. Ellos recibirán una invitación por email para unirse a la plataforma.","action-text":"Invitar empleados","action-icon":h(R),onAction:s[1]||(s[1]=a=>b.value=!0)},null,8,["icon","action-icon"])])),b.value?(l(),V(X,{key:3,departamentos:c.value,onClose:s[2]||(s[2]=a=>b.value=!1),onSubmit:U},null,8,["departamentos"])):M("",!0),x.value?(l(),V(le,{key:4,empleado:t.value,departamentos:c.value,onClose:s[3]||(s[3]=a=>x.value=!1),onSubmit:z},null,8,["empleado","departamentos"])):M("",!0)]))}};export{He as default};

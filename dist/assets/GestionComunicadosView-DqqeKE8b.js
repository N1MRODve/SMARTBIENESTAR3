import{d as m,B as h,f as T,h as l,j as t,v as a,z as i,u as b,t as r,F as z,y as B,D as F,o as d,I as f,E as y}from"./vue-vendor-DLSXyIw7.js";import{u as M,s as _,h as w,M as v,A as R,R as V}from"./index-D33O_vwf.js";import{_ as I}from"./EmptyState-mSYFNM8S.js";import{P as C}from"./plus-n9pYVzkT.js";import{S as G}from"./square-pen-Bab3IBLH.js";import{T as L}from"./trash-2-OdR_kCZk.js";import"./supabase-B7V2753y.js";const H={class:"space-y-8"},J={class:"bg-gradient-to-r from-green-600 to-teal-600 rounded-2xl shadow-xl p-8"},K={class:"flex items-center justify-between"},O={class:"flex items-center space-x-4"},Q={class:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center"},U={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},W={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},X={class:"text-4xl font-bold text-green-600"},Y={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},Z={class:"text-4xl font-bold text-blue-600"},tt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},et={class:"text-4xl font-bold text-purple-600"},st={key:0,class:"flex items-center justify-center py-12"},ot={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 text-center"},rt={class:"text-red-600 mb-4"},at={key:2,class:"bg-white rounded-xl shadow-lg border border-gray-200"},it={key:3,class:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden"},nt={class:"overflow-x-auto"},lt={class:"w-full"},dt={class:"divide-y divide-gray-200"},ct={class:"px-6 py-4"},ut={class:"max-w-md"},xt={class:"text-sm font-medium text-gray-900 mb-1"},mt={class:"text-xs text-gray-500 line-clamp-2"},pt={class:"px-6 py-4 whitespace-nowrap"},gt={class:"px-6 py-4 whitespace-nowrap"},ht={class:"text-lg mr-1"},bt={class:"text-sm font-medium text-gray-900 capitalize"},ft={class:"px-6 py-4 whitespace-nowrap"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},_t={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},wt={class:"flex items-center justify-end gap-2"},vt=["onClick"],Ct=["onClick"],$t={__name:"GestionComunicadosView",setup(kt){const p=F(),k=M(),n=m([]),u=m(!0),c=m(null),E=h(()=>{const s=new Date;return s.setDate(s.getDate()-7),n.value.filter(e=>new Date(e.created_at)>=s).length}),D=h(()=>{if(n.value.length===0)return"-";const s=n.value[0],e=Math.floor((new Date-new Date(s.created_at))/(1e3*60*60*24));return e===0?"Hoy":`${e} dÃ­a${e!==1?"s":""}`});T(async()=>{await x()});const x=async()=>{u.value=!0,c.value=null;try{const{data:s,error:e}=await _.from("comunicados").select("*").eq("empresa_id",k.empresaId).order("created_at",{ascending:!1});if(e)throw e;n.value=s||[]}catch(s){console.error("Error cargando comunicados:",s),c.value="No se pudieron cargar los comunicados"}finally{u.value=!1}},g=()=>{p.push("/admin/comunicados/crear")},S=s=>{p.push(`/admin/comunicados/${s}/editar`)},N=async s=>{if(confirm("Â¿EstÃ¡s seguro de eliminar este comunicado?"))try{const{error:e}=await _.from("comunicados").delete().eq("id",s);if(e)throw e;await x()}catch(e){console.error("Error eliminando comunicado:",e),alert("Error al eliminar el comunicado")}},j=s=>({informativo:"bg-blue-100 text-blue-800",urgente:"bg-red-100 text-red-800",anuncio:"bg-green-100 text-green-800",celebracion:"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",A=s=>({borrador:"bg-yellow-100 text-yellow-800",programado:"bg-blue-100 text-blue-800",enviado:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",P=s=>({alta:"ðŸ”´",media:"ðŸŸ¡",baja:"ðŸŸ¢"})[s]||"âšª",$=s=>new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(s,e)=>(d(),l("div",H,[t("div",J,[t("div",K,[t("div",O,[t("div",Q,[a(i(v),{class:"h-8 w-8 text-white"})]),e[0]||(e[0]=t("div",null,[t("h1",{class:"text-3xl font-bold text-white"},"GestiÃ³n de Comunicados"),t("p",{class:"text-white/80 mt-1"},"Administra los mensajes para tu equipo")],-1))]),a(w,{onClick:g,class:"bg-white text-green-600 font-semibold hover:bg-green-50"},{default:b(()=>[a(i(C),{class:"h-5 w-5 mr-2"}),e[1]||(e[1]=f(" Nuevo Comunicado "))]),_:1,__:[1]})])]),t("div",U,[t("div",W,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Total Comunicados",-1)),t("p",X,r(n.value.length),1),e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 mt-1"},"Publicados",-1))]),t("div",Y,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Esta Semana",-1)),t("p",Z,r(E.value),1),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 mt-1"},"Nuevos",-1))]),t("div",tt,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Ãšltimo Comunicado",-1)),t("p",et,r(D.value),1),e[7]||(e[7]=t("p",{class:"text-sm text-gray-500 mt-1"},"PublicaciÃ³n",-1))])]),u.value?(d(),l("div",st,e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1)]))):c.value?(d(),l("div",ot,[a(i(R),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar los comunicados",-1)),t("p",rt,r(c.value),1),a(w,{onClick:x},{default:b(()=>[a(i(V),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=f(" Reintentar "))]),_:1,__:[9]})])):n.value.length===0?(d(),l("div",at,[a(I,{icon:i(v),title:"No hay comunicados",description:"Crea tu primer comunicado para mantener informado a tu equipo.","action-text":"Crear comunicado","action-icon":i(C),onAction:g},null,8,["icon","action-icon"])])):(d(),l("div",it,[t("div",nt,[t("table",lt,[e[11]||(e[11]=t("thead",{class:"bg-gray-50 border-b border-gray-200"},[t("tr",null,[t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Comunicado "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Tipo "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Prioridad "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Estado "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Fecha "),t("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ")])],-1)),t("tbody",dt,[(d(!0),l(z,null,B(n.value,o=>(d(),l("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[t("td",ct,[t("div",ut,[t("div",xt,r(o.titulo),1),t("div",mt,r(o.contenido),1)])]),t("td",pt,[t("span",{class:y([j(o.tipo),"px-3 py-1 text-xs font-medium rounded-full capitalize"])},r(o.tipo),3)]),t("td",gt,[t("span",ht,r(P(o.prioridad)),1),t("span",bt,r(o.prioridad),1)]),t("td",ft,[t("span",{class:y([A(o.estado),"px-3 py-1 text-xs font-medium rounded-full capitalize"])},r(o.estado),3)]),t("td",yt,r($(o.created_at)),1),t("td",_t,[t("div",wt,[t("button",{onClick:q=>S(o.id),class:"text-blue-600 hover:text-blue-900 transition-colors",title:"Editar"},[a(i(G),{class:"h-4 w-4"})],8,vt),t("button",{onClick:q=>N(o.id),class:"text-red-600 hover:text-red-900 transition-colors",title:"Eliminar"},[a(i(L),{class:"h-4 w-4"})],8,Ct)])])]))),128))])])])]))]))}};export{$t as default};

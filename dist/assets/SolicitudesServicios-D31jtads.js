import{d as v,f as W,h as p,j as e,v as d,z as c,t as a,F as q,y as B,I as X,b as D,u as f,D as Y,o as g,E as N}from"./vue-vendor-DLSXyIw7.js";import{u as Z}from"./index-DPgCtSRZ.js";import{d as ee,s as h,u as te,F as R,q as se,C as oe,o as ae}from"./index-D33O_vwf.js";import{s as V}from"./dialog.esm-C9zKQD4N.js";import{F as ie}from"./file-check-BY5XkRoE.js";import{A as L}from"./alert-triangle-Dg4Dpai8.js";import{B as re}from"./building-26PfV7_i.js";import{E as le}from"./eye-D40qS93y.js";import{T as ne}from"./trash-2-OdR_kCZk.js";import{P as de}from"./plus-n9pYVzkT.js";import"./supabase-B7V2753y.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ee("PlayCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),z={async getAll(m){const{data:i,error:r}=await h.from("solicitudes_servicios").select(`
        *,
        empleado:empleados!inner (
          nombre,
          email,
          departamentos (
            nombre
          )
        ),
        servicio:servicios (
          nombre,
          categoria,
          tipo,
          descripcion
        )
      `).eq("empleado.empresa_id",m).order("fecha_solicitud",{ascending:!1});if(r)throw r;return i||[]},async getById(m){const{data:i,error:r}=await h.from("solicitudes_servicios").select(`
        *,
        empleado:empleados (
          nombre,
          email,
          departamentos (
            nombre
          )
        ),
        servicio:servicios (
          nombre,
          categoria,
          tipo,
          descripcion
        )
      `).eq("id",m).single();if(r)throw r;return i},async create(m){const{data:i,error:r}=await h.from("solicitudes_servicios").insert([m]).select().single();if(r)throw r;return i},async updateEstado(m,i,r=null){const u={estado:i,fecha_respuesta:new Date().toISOString()};r&&(u.notas_admin=r);const{data:x,error:l}=await h.from("solicitudes_servicios").update(u).eq("id",m).select().single();if(l)throw l;return x},async delete(m){const{error:i}=await h.from("solicitudes_servicios").delete().eq("id",m);if(i)throw i},async getEstadisticas(m){const i=await this.getAll(m);return{pendientes:i.filter(u=>u.estado==="pendiente").length,aprobadas:i.filter(u=>u.estado==="aprobada").length,rechazadas:i.filter(u=>u.estado==="rechazada").length,completadas:i.filter(u=>u.estado==="completada").length,total:i.length}}},me={class:"min-h-screen bg-gray-50"},ue={class:"py-8"},pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ge={class:"mb-8"},xe={class:"flex items-center justify-between mb-4"},ve={class:"flex items-center gap-2 px-4 py-2 bg-indigo-100 rounded-full"},be={class:"text-sm font-semibold text-indigo-700"},ye={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},fe={class:"bg-white rounded-lg p-4 shadow-sm border-l-4 border-yellow-500"},he={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-yellow-700"},we={class:"bg-white rounded-lg p-4 shadow-sm border-l-4 border-blue-500"},Ee={class:"flex items-center justify-between"},Ce={class:"text-2xl font-bold text-blue-700"},ke={class:"bg-white rounded-lg p-4 shadow-sm border-l-4 border-green-500"},Se={class:"flex items-center justify-between"},De={class:"text-2xl font-bold text-green-700"},ze={class:"bg-white rounded-lg p-4 shadow-sm border-l-4 border-gray-500"},je={class:"flex items-center justify-between"},Ie={class:"text-2xl font-bold text-gray-700"},Pe={key:0,class:"flex items-center justify-center py-12"},Te={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 text-center mb-8"},Ae={class:"text-red-600 mb-4"},Fe={key:2,class:"bg-white shadow-sm rounded-xl overflow-hidden"},qe={class:"overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-white divide-y divide-gray-200"},Re={class:"px-6 py-4"},Ve={class:"flex items-center gap-3"},Le={class:"text-2xl"},$e={class:"text-sm font-semibold text-gray-900"},Me={class:"text-xs text-gray-500"},Oe={class:"px-6 py-4"},Ue={class:"flex items-center gap-2"},Ge={class:"text-sm text-gray-900"},He={class:"px-6 py-4"},Je={class:"flex items-center gap-2"},Ke={class:"text-sm text-gray-900"},Qe={class:"px-6 py-4"},We=["value","onChange"],Xe=["value"],Ye={class:"px-6 py-4"},Ze={class:"flex items-center gap-2"},et=["onClick"],tt=["onClick"],st={key:0,class:"text-center py-12"},ot={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},at={class:"flex items-center gap-3"},it={class:"text-3xl"},rt={class:"text-sm text-gray-600"},lt={key:0,class:"space-y-6"},nt={class:"text-base text-gray-900"},dt={class:"grid grid-cols-2 gap-4"},ct={class:"text-base text-gray-900"},mt={class:"text-base text-gray-900"},ut={class:"text-base text-gray-900"},pt={class:"text-sm text-gray-900 bg-gray-50 p-4 rounded-lg"},gt={key:0},xt={class:"text-sm text-gray-900 bg-gray-50 p-4 rounded-lg"},vt={class:"text-base text-gray-900"},bt={class:"flex items-center gap-3"},yt={class:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center"},ft={class:"space-y-4"},ht={class:"bg-gray-50 p-4 rounded-lg"},_t={class:"text-sm font-semibold text-gray-900"},wt={class:"text-xs text-gray-600 mt-1"},Et={class:"flex items-center justify-end gap-3"},qt={__name:"SolicitudesServicios",setup(m){const i=Y(),r=Z(),u=te(),x=v([]),l=v(null),b=v(null),E=v(!1),y=v(!1),C=v(!0),_=v(null),$=["Pendiente","En curso","Completado","Rechazado"];W(async()=>{await w()});const w=async()=>{C.value=!0,_.value=null;try{const s=await z.getAll(u.empresaId);x.value=s.map(t=>{var o,n,I,P,T,A,F;return{id:t.id,servicio:{nombre:((o=t.servicio)==null?void 0:o.nombre)||"Servicio eliminado",icono:M((n=t.servicio)==null?void 0:n.categoria)},departamento:((P=(I=t.empleado)==null?void 0:I.departamentos)==null?void 0:P.nombre)||"Sin departamento",fecha_solicitud:(T=t.fecha_solicitud)==null?void 0:T.split("T")[0],fecha_implementacion:(A=t.fecha_respuesta)==null?void 0:A.split("T")[0],estado:O(t.estado),objetivos:t.motivo,comentarios:t.notas_admin,solicitante:((F=t.empleado)==null?void 0:F.nombre)||"Empleado"}})}catch(s){console.error("Error cargando solicitudes:",s),_.value="No se pudieron cargar las solicitudes"}finally{C.value=!1}},M=s=>({salud_mental:"ðŸ§ ",fisico:"ðŸ‹ï¸",financiero:"ðŸ’°",legal:"âš–ï¸",familiar:"ðŸ‘¨â€ðŸ‘©â€ðŸ‘§"})[s]||"ðŸ“",O=s=>s==="pendiente"?"Pendiente":s==="aprobada"?"En curso":s==="completada"?"Completado":s==="rechazada"?"Rechazado":s,U=s=>s==="Pendiente"?"pendiente":s==="En curso"?"aprobada":s==="Completado"?"completada":s==="Rechazado"?"rechazada":s,k=s=>x.value.filter(t=>t.estado===s).length,S=s=>s?new Date(s+"T00:00:00").toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-",G=async(s,t)=>{try{await z.updateEstado(s,U(t)),await w(),r.info(`Estado actualizado a "${t}"`,{timeout:3e3})}catch(o){console.error("Error actualizando estado:",o),r.error("Error al actualizar el estado")}},H=s=>{l.value=s,E.value=!0},J=s=>{b.value=s,y.value=!0},K=async()=>{if(b.value)try{await z.delete(b.value.id),await w(),r.success("Solicitud eliminada correctamente",{timeout:3e3}),y.value=!1,b.value=null}catch(s){console.error("Error eliminando solicitud:",s),r.error("Error al eliminar la solicitud")}},Q=()=>{i.push({name:"admin-servicios"})},j=s=>({Pendiente:{badge:"bg-yellow-100 text-yellow-800"},"En curso":{badge:"bg-blue-100 text-blue-800"},Completado:{badge:"bg-green-100 text-green-800"},Rechazado:{badge:"bg-red-100 text-red-800"}})[s]||{badge:"bg-gray-100 text-gray-800"};return(s,t)=>(g(),p("div",me,[e("div",ue,[e("div",pe,[e("div",ge,[e("div",xe,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"}," Solicitudes de Servicios "),e("p",{class:"text-gray-600 mt-2"}," Gestiona las solicitudes de implementaciÃ³n de programas y talleres ")],-1)),e("div",ve,[d(c(R),{class:"h-5 w-5 text-indigo-600"}),e("span",be,a(x.value.length)+" solicitud"+a(x.value.length!==1?"es":""),1)])]),e("div",ye,[e("div",fe,[e("div",he,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-sm text-gray-600"},"Pendientes",-1)),e("p",_e,a(k("Pendiente")),1)]),d(c(se),{class:"h-8 w-8 text-yellow-500"})])]),e("div",we,[e("div",Ee,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-600"},"En curso",-1)),e("p",Ce,a(k("En curso")),1)]),d(c(ce),{class:"h-8 w-8 text-blue-500"})])]),e("div",ke,[e("div",Se,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-600"},"Completados",-1)),e("p",De,a(k("Completado")),1)]),d(c(oe),{class:"h-8 w-8 text-green-500"})])]),e("div",ze,[e("div",je,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"},"Total",-1)),e("p",Ie,a(x.value.length),1)]),d(c(ie),{class:"h-8 w-8 text-gray-500"})])])])]),C.value?(g(),p("div",Pe,t[8]||(t[8]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):_.value?(g(),p("div",Te,[d(c(L),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),t[9]||(t[9]=e("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar datos",-1)),e("p",Ae,a(_.value),1),e("button",{onClick:w,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Reintentar ")])):(g(),p("div",Fe,[e("div",qe,[e("table",Be,[t[10]||(t[10]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Servicio "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Departamento "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha ImplementaciÃ³n "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado "),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",Ne,[(g(!0),p(q,null,B(x.value,o=>(g(),p("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Re,[e("div",Ve,[e("span",Le,a(o.servicio.icono),1),e("div",null,[e("p",$e,a(o.servicio.nombre),1),e("p",Me," ID: "+a(o.id),1)])])]),e("td",Oe,[e("div",Ue,[d(c(re),{class:"h-4 w-4 text-gray-400"}),e("span",Ge,a(o.departamento),1)])]),e("td",He,[e("div",Je,[d(c(ae),{class:"h-4 w-4 text-gray-400"}),e("span",Ke,a(S(o.fecha_implementacion)),1)])]),e("td",Qe,[e("select",{value:o.estado,onChange:n=>G(o.id,n.target.value),class:N(["text-xs font-medium px-3 py-1.5 rounded-full border-0 cursor-pointer transition-colors",j(o.estado).badge])},[(g(),p(q,null,B($,n=>e("option",{key:n,value:n},a(n),9,Xe)),64))],42,We)]),e("td",Ye,[e("div",Ze,[e("button",{onClick:n=>H(o),class:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Ver detalles"},[d(c(le),{class:"h-5 w-5"})],8,et),e("button",{onClick:n=>J(o),class:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar"},[d(c(ne),{class:"h-5 w-5"})],8,tt)])])]))),128))])])]),x.value.length===0?(g(),p("div",st,[e("div",ot,[d(c(R),{class:"h-8 w-8 text-gray-400"})]),t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"}," No hay solicitudes registradas ",-1)),t[13]||(t[13]=e("p",{class:"text-gray-600 mb-4"}," Las solicitudes de implementaciÃ³n aparecerÃ¡n aquÃ­ ",-1)),e("button",{onClick:Q,class:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},[d(c(de),{class:"h-5 w-5"}),t[11]||(t[11]=X(" Explorar servicios "))])])):D("",!0)]))])]),d(c(V),{visible:E.value,"onUpdate:visible":t[0]||(t[0]=o=>E.value=o),modal:"",dismissableMask:!0,style:{width:"50rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{header:f(()=>{var o,n;return[e("div",at,[e("span",it,a((o=l.value)==null?void 0:o.servicio.icono),1),e("div",null,[t[14]||(t[14]=e("h3",{class:"text-xl font-bold text-gray-900"}," Detalles de la Solicitud ",-1)),e("p",rt," ID: "+a((n=l.value)==null?void 0:n.id),1)])])]}),default:f(()=>[l.value?(g(),p("div",lt,[e("div",null,[t[15]||(t[15]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Servicio",-1)),e("p",nt,a(l.value.servicio.nombre),1)]),e("div",dt,[e("div",null,[t[16]||(t[16]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Departamento",-1)),e("p",ct,a(l.value.departamento),1)]),e("div",null,[t[17]||(t[17]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Estado",-1)),e("span",{class:N(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",j(l.value.estado).badge])},a(l.value.estado),3)]),e("div",null,[t[18]||(t[18]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Fecha de Solicitud",-1)),e("p",mt,a(S(l.value.fecha_solicitud)),1)]),e("div",null,[t[19]||(t[19]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Fecha de ImplementaciÃ³n",-1)),e("p",ut,a(S(l.value.fecha_implementacion)),1)])]),e("div",null,[t[20]||(t[20]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Objetivos EspecÃ­ficos",-1)),e("p",pt,a(l.value.objetivos),1)]),l.value.comentarios?(g(),p("div",gt,[t[21]||(t[21]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Comentarios",-1)),e("p",xt,a(l.value.comentarios),1)])):D("",!0),e("div",null,[t[22]||(t[22]=e("h4",{class:"text-sm font-semibold text-gray-700 mb-2"},"Solicitante",-1)),e("p",vt,a(l.value.solicitante),1)])])):D("",!0)]),_:1},8,["visible"]),d(c(V),{visible:y.value,"onUpdate:visible":t[2]||(t[2]=o=>y.value=o),modal:"",dismissableMask:!0,style:{width:"30rem"}},{header:f(()=>[e("div",bt,[e("div",yt,[d(c(L),{class:"h-6 w-6 text-red-600"})]),t[23]||(t[23]=e("h3",{class:"text-xl font-bold text-gray-900"}," Confirmar eliminaciÃ³n ",-1))])]),footer:f(()=>[e("div",Et,[e("button",{onClick:t[1]||(t[1]=o=>y.value=!1),class:"px-4 py-2 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors"}," Cancelar "),e("button",{onClick:K,class:"px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors"}," Eliminar ")])]),default:f(()=>{var o,n;return[e("div",ft,[t[24]||(t[24]=e("p",{class:"text-gray-700"}," Â¿EstÃ¡s seguro de que deseas eliminar esta solicitud? ",-1)),e("div",ht,[e("p",_t,a((o=b.value)==null?void 0:o.servicio.nombre),1),e("p",wt," Departamento: "+a((n=b.value)==null?void 0:n.departamento),1)]),t[25]||(t[25]=e("p",{class:"text-sm text-red-600"}," Esta acciÃ³n no se puede deshacer. ",-1))])]}),_:1},8,["visible"])]))}};export{qt as default};

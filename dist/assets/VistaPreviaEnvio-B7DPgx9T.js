import{d as v,B as D,f as J,h as r,j as e,v as d,u as w,t as a,b as m,z as c,I as u,E as k,c as K,l as X,q as Q,V as W,F as N,y as V,K as Y,D as Z,U as ee,o as l,G as se}from"./vue-vendor-DLSXyIw7.js";import{f as te,b as ae,_ as E,F as j,o as oe,U as ie,m as ne,S as le,C as re,L as de}from"./index-D33O_vwf.js";import{S as T,U as ce}from"./user-check-BfZhHJN9.js";import{A as ue}from"./arrow-left-DGT1lY9t.js";import{E as me}from"./eye-D40qS93y.js";import{X as ge}from"./x-qOn0wnZo.js";import"./supabase-B7V2753y.js";const b=[{id:1,nombre:"RRHH",empleados:8,color:"bg-blue-100 text-blue-800"},{id:2,nombre:"Marketing",empleados:12,color:"bg-purple-100 text-purple-800"},{id:3,nombre:"Ventas",empleados:15,color:"bg-green-100 text-green-800"},{id:4,nombre:"Producci贸n",empleados:10,color:"bg-orange-100 text-orange-800"},{id:5,nombre:"Desarrollo",empleados:18,color:"bg-indigo-100 text-indigo-800"},{id:6,nombre:"Administraci贸n",empleados:7,color:"bg-gray-100 text-gray-800"}],pe=()=>b.reduce((P,g)=>P+g.empleados,0),ve={class:"min-h-screen bg-gray-50"},xe={class:"py-8"},be={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8"},fe={class:"mb-8"},_e={class:"flex items-center justify-between"},ye={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},he={class:"lg:col-span-2 space-y-6"},we={class:"bg-white rounded-xl shadow-sm p-6"},ke={class:"space-y-4"},Ee={class:"text-lg font-medium text-gray-900 mt-1"},Ce={key:0},Se={class:"text-gray-700 mt-1"},De={class:"flex items-center gap-6 pt-2 flex-wrap"},Ne={class:"flex items-center text-sm text-gray-600"},Ve={class:"flex items-center text-sm text-gray-600"},je={class:"pt-4 border-t border-gray-200"},Pe={class:"font-semibold text-sm"},Ae={class:"text-xs mt-1 text-gray-600"},Le={class:"mt-6"},Te={class:"bg-white rounded-xl shadow-sm p-6"},Re={class:"mb-4"},ze={class:"ml-3 flex-1"},Me={class:"flex items-center justify-between"},Ue={class:"text-sm font-medium text-indigo-700"},$e={class:"space-y-3"},Be=["onClick"],Fe=["checked","onChange"],Ie={class:"ml-3 flex-1 flex items-center justify-between"},qe={class:"font-medium text-gray-900"},He={class:"text-sm text-gray-600"},Oe={class:"lg:col-span-1"},Ge={class:"bg-white rounded-xl shadow-sm p-6 sticky top-6"},Je={class:"space-y-4 text-sm"},Ke={class:"flex items-start"},Xe={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},Qe={class:"flex-1"},We={class:"text-gray-600 mt-1"},Ye={class:"flex items-start"},Ze={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},es={class:"flex-1"},ss={class:"text-gray-600 mt-1"},ts={class:"flex items-start"},as={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},os={class:"flex-1"},is={class:"text-gray-600 mt-1"},ns={class:"text-indigo-600 font-semibold mt-1"},ls={class:"mt-6 pt-6 border-t border-gray-200"},rs={key:0,class:"text-xs text-gray-500 mt-2 text-center"},ds={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},cs={class:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},us={class:"sticky top-0 bg-white border-b border-gray-200 p-6 z-10"},ms={class:"flex justify-between items-start"},gs={class:"p-6"},ps={class:"bg-gray-50 rounded-lg p-6 mb-4"},vs={class:"text-xl font-bold text-gray-900 mb-2"},xs={key:0,class:"text-gray-600 mb-4"},bs={class:"flex items-center text-sm text-gray-500"},fs={key:0,class:"bg-white border border-gray-200 rounded-lg p-6"},_s={class:"mb-4"},ys={class:"text-sm text-gray-500"},hs={class:"text-lg font-medium text-gray-900 mb-4"},ws={key:0,class:"space-y-3"},ks={class:"flex items-center justify-between"},Es={class:"text-sm font-medium text-gray-700"},Cs={key:1,class:"space-y-3"},Ss={key:2,class:"space-y-3"},Ds={class:"text-gray-700"},Ns={key:3,class:"space-y-3"},Vs={class:"text-xs text-green-600 flex items-center"},js={class:"mt-6 flex justify-end"},Ps={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},As={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 text-center"},Ls={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},Ts={class:"text-gray-600 mb-6"},Is={__name:"VistaPreviaEnvio",setup(P){const g=Z();ee();const f=te(),R=ae(),t=v({titulo:"",descripcion:"",preguntas:[],categoria:"",creada_desde:"custom"}),i=v([]),x=v(!1),C=v(!1),_=v(!1),A=v(!1),z=D(()=>pe()),y=D(()=>i.value.reduce((o,s)=>{const p=b.find(h=>h.id===s);return o+((p==null?void 0:p.empleados)||0)},0)),M=D(()=>new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}));J(()=>{U()});const U=()=>{const o=sessionStorage.getItem("encuesta_preview");if(o)try{t.value=JSON.parse(o)}catch(s){console.error("Error al cargar datos de encuesta:",s),f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los datos de la encuesta",life:4e3}),g.push("/admin/encuestas")}else f.add({severity:"warn",summary:"Sin datos",detail:"No hay datos de encuesta para previsualizar",life:4e3}),g.push("/admin/encuestas")},L=o=>{const s=i.value.indexOf(o);s>-1?i.value.splice(s,1):i.value.push(o),x.value=i.value.length===b.length},$=()=>{x.value?i.value=b.map(o=>o.id):i.value=[]},B=async()=>{if(i.value.length===0){f.add({severity:"warn",summary:"Sin destinatarios",detail:"Debes seleccionar al menos un departamento",life:4e3});return}C.value=!0;try{await new Promise(o=>setTimeout(o,1500)),await R.createNewSurvey({...t.value,estado:"activa",fecha_envio:new Date,departamentos_destinatarios:i.value,total_destinatarios:y.value}),sessionStorage.removeItem("encuesta_preview"),A.value=!0}catch(o){console.error("Error al enviar encuesta:",o),f.add({severity:"error",summary:"Error al enviar",detail:o.message||"No se pudo enviar la encuesta",life:5e3})}finally{C.value=!1}},F=()=>{g.back()},I=()=>{g.push("/admin/encuestas")},q=o=>({anonimato_completo:T,anonimato_parcial:de,identificado:ce})[o]||T,H=o=>({anonimato_completo:"An贸nimo completo",anonimato_parcial:"An贸nimo parcial",identificado:"Identificado (con prop贸sito)"})[o]||"An贸nimo completo",O=o=>({anonimato_completo:"Respuestas 100% an贸nimas sin identificadores",anonimato_parcial:"Agrupadas por departamento sin datos individuales",identificado:"Asociadas al usuario con fines de seguimiento"})[o]||"Respuestas 100% an贸nimas",G=o=>({anonimato_completo:"bg-green-50 border-green-300 text-green-800",anonimato_parcial:"bg-orange-50 border-orange-300 text-orange-800",identificado:"bg-blue-50 border-blue-300 text-blue-800"})[o]||"bg-green-50 border-green-300 text-green-800";return(o,s)=>{var p,h;return l(),r("div",ve,[e("div",xe,[e("div",be,[e("div",fe,[e("div",_e,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Vista Previa de Env铆o"),e("p",{class:"mt-2 text-lg text-gray-600"},"Selecciona los destinatarios de tu encuesta")],-1)),d(E,{onClick:F,variant:"outline"},{default:w(()=>[d(c(ue),{class:"h-5 w-5 mr-2"}),s[5]||(s[5]=u(" Volver "))]),_:1,__:[5]})])]),e("div",ye,[e("div",he,[e("div",we,[s[12]||(s[12]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Resumen de la Encuesta",-1)),e("div",ke,[e("div",null,[s[7]||(s[7]=e("label",{class:"text-sm font-medium text-gray-500"},"T铆tulo",-1)),e("p",Ee,a(t.value.titulo),1)]),t.value.descripcion?(l(),r("div",Ce,[s[8]||(s[8]=e("label",{class:"text-sm font-medium text-gray-500"},"Descripci贸n",-1)),e("p",Se,a(t.value.descripcion),1)])):m("",!0),e("div",De,[e("div",Ne,[d(c(j),{class:"h-5 w-5 mr-2 text-primary"}),e("span",null,[e("strong",null,a(((p=t.value.preguntas)==null?void 0:p.length)||0),1),s[9]||(s[9]=u(" preguntas"))])]),e("div",Ve,[e("span",{class:k(["px-3 py-1 rounded-full text-xs font-medium",t.value.creada_desde==="plantilla"?"bg-indigo-50 text-indigo-800":"bg-gray-50 text-gray-800"])},a(t.value.creada_desde==="plantilla"?"З Desde plantilla":"П Desde cero"),3)])]),e("div",je,[s[10]||(s[10]=e("label",{class:"text-sm font-medium text-gray-500 mb-2 block"},"Nivel de Privacidad",-1)),e("div",{class:k(["flex items-start p-3 rounded-lg border-2",G(t.value.privacidadNivel||"anonimato_completo")])},[(l(),K(X(q(t.value.privacidadNivel||"anonimato_completo")),{class:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"})),e("div",null,[e("p",Pe,a(H(t.value.privacidadNivel||"anonimato_completo")),1),e("p",Ae,a(O(t.value.privacidadNivel||"anonimato_completo")),1)])],2)])]),e("div",Le,[e("button",{onClick:s[0]||(s[0]=n=>_.value=!0),class:"text-primary hover:text-primary-dark font-medium text-sm flex items-center"},[d(c(me),{class:"h-4 w-4 mr-2"}),s[11]||(s[11]=u(" Ver c贸mo la recibe un empleado "))])])]),e("div",Te,[s[14]||(s[14]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Seleccionar Destinatarios",-1)),s[15]||(s[15]=e("p",{class:"text-sm text-gray-600 mb-6"}," Selecciona los departamentos o grupos de empleados a los que deseas enviar esta encuesta. ",-1)),e("div",Re,[e("label",{class:k(["flex items-center p-4 bg-indigo-50 border-2 border-indigo-200 rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors",{"ring-2 ring-indigo-500":x.value}])},[Q(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=n=>x.value=n),onChange:$,class:"h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,544),[[W,x.value]]),e("div",ze,[e("div",Me,[s[13]||(s[13]=e("span",{class:"font-semibold text-gray-900"},"Todos los empleados",-1)),e("span",Ue,a(z.value)+" empleados ",1)])])],2)]),e("div",$e,[(l(!0),r(N,null,V(c(b),n=>(l(),r("div",{key:n.id,class:k(["flex items-center p-3 bg-gray-50 hover:bg-indigo-50 rounded-lg cursor-pointer transition-colors border-2",i.value.includes(n.id)?"border-indigo-300 bg-indigo-50":"border-transparent"]),onClick:S=>L(n.id)},[e("input",{type:"checkbox",checked:i.value.includes(n.id),onChange:S=>L(n.id),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",onClick:s[2]||(s[2]=se(()=>{},["stop"]))},null,40,Fe),e("div",Ie,[e("div",null,[e("span",qe,a(n.nombre),1)]),e("span",He,a(n.empleados)+" empleados ",1)])],10,Be))),128))])])]),e("div",Oe,[e("div",Ge,[s[20]||(s[20]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Resumen de Env铆o",-1)),e("div",Je,[e("div",Ke,[e("div",Xe,[d(c(j),{class:"h-4 w-4 text-indigo-600"})]),e("div",Qe,[s[16]||(s[16]=e("p",{class:"font-medium text-gray-700"},"Encuesta",-1)),e("p",We,a(t.value.titulo),1)])]),e("div",Ye,[e("div",Ze,[d(c(oe),{class:"h-4 w-4 text-indigo-600"})]),e("div",es,[s[17]||(s[17]=e("p",{class:"font-medium text-gray-700"},"Fecha de creaci贸n",-1)),e("p",ss,a(M.value),1)])]),e("div",ts,[e("div",as,[d(c(ie),{class:"h-4 w-4 text-indigo-600"})]),e("div",os,[s[18]||(s[18]=e("p",{class:"font-medium text-gray-700"},"Destinatarios",-1)),e("p",is,a(i.value.length)+" departamento"+a(i.value.length!==1?"s":""),1),e("p",ns,a(y.value)+" empleado"+a(y.value!==1?"s":""),1)])])]),e("div",ls,[d(E,{onClick:B,disabled:i.value.length===0,loading:C.value,class:"w-full bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-gray-300"},{default:w(()=>[d(c(ne),{class:"h-4 w-4 mr-2"}),s[19]||(s[19]=u(" Enviar Encuesta "))]),_:1,__:[19]},8,["disabled","loading"]),i.value.length===0?(l(),r("p",rs," Selecciona al menos un departamento ")):m("",!0)])])])])])]),_.value?(l(),r("div",ds,[e("div",cs,[e("div",us,[e("div",ms,[s[21]||(s[21]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-900"},"Vista Previa"),e("p",{class:"text-gray-600 mt-1"},"As铆 ver谩 la encuesta un empleado")],-1)),e("button",{onClick:s[3]||(s[3]=n=>_.value=!1),class:"text-gray-400 hover:text-gray-600 transition-colors"},[d(c(ge),{class:"h-6 w-6"})])])]),e("div",gs,[e("div",ps,[e("h3",vs,a(t.value.titulo),1),t.value.descripcion?(l(),r("p",xs,a(t.value.descripcion),1)):m("",!0),e("div",bs,[d(c(j),{class:"h-4 w-4 mr-2"}),u(" "+a(((h=t.value.preguntas)==null?void 0:h.length)||0)+" preguntas ",1)])]),t.value.preguntas&&t.value.preguntas.length>0?(l(),r("div",fs,[e("div",_s,[e("span",ys,"Pregunta 1 de "+a(t.value.preguntas.length),1)]),e("h4",hs,a(t.value.preguntas[0].texto),1),t.value.preguntas[0].tipo==="escala_1_5"?(l(),r("div",ws,[s[23]||(s[23]=e("div",{class:"flex items-center justify-between text-sm text-gray-500 mb-2"},[e("span",null,"Muy insatisfecho"),e("span",null,"Muy satisfecho")],-1)),e("div",ks,[(l(),r(N,null,V([1,2,3,4,5],n=>e("div",{key:n,class:"flex flex-col items-center"},[s[22]||(s[22]=e("input",{type:"radio",name:"preview-escala",class:"mb-2 h-5 w-5",disabled:""},null,-1)),e("span",Es,a(n),1)])),64))])])):t.value.preguntas[0].tipo==="si_no"?(l(),r("div",Cs,s[24]||(s[24]=[Y('<label class="flex items-center p-3 bg-gray-50 rounded-lg"><input type="radio" name="preview-sino" class="mr-3 h-4 w-4" disabled><span class="text-gray-700">S铆</span></label><label class="flex items-center p-3 bg-gray-50 rounded-lg"><input type="radio" name="preview-sino" class="mr-3 h-4 w-4" disabled><span class="text-gray-700">No</span></label>',2)]))):t.value.preguntas[0].tipo==="opcion_multiple"?(l(),r("div",Ss,[(l(!0),r(N,null,V(t.value.preguntas[0].opciones,(n,S)=>(l(),r("label",{key:S,class:"flex items-center p-3 bg-gray-50 rounded-lg"},[s[25]||(s[25]=e("input",{type:"radio",name:"preview-multiple",class:"mr-3 h-4 w-4",disabled:""},null,-1)),e("span",Ds,a(n),1)]))),128))])):t.value.preguntas[0].tipo==="texto_abierto"?(l(),r("div",Ns,[s[27]||(s[27]=e("textarea",{class:"w-full px-3 py-2 border border-gray-300 rounded-md resize-none",rows:"4",placeholder:"Escribe tu respuesta aqu铆...",disabled:""},null,-1)),e("p",Vs,[d(c(le),{class:"h-4 w-4 mr-1"}),s[26]||(s[26]=u(" Tu respuesta es 100% an贸nima "))])])):m("",!0)])):m("",!0),e("div",js,[d(E,{onClick:s[4]||(s[4]=n=>_.value=!1),variant:"outline"},{default:w(()=>s[28]||(s[28]=[u(" Cerrar Vista Previa ")])),_:1,__:[28]})])])])])):m("",!0),A.value?(l(),r("div",Ps,[e("div",As,[e("div",Ls,[d(c(re),{class:"h-10 w-10 text-green-600"})]),s[30]||(s[30]=e("h3",{class:"text-2xl font-bold text-gray-900 mb-2"},"隆Encuesta Enviada!",-1)),e("p",Ts," La encuesta ha sido enviada correctamente a "+a(y.value)+" empleados en "+a(i.value.length)+" departamento"+a(i.value.length!==1?"s":"")+". ",1),d(E,{onClick:I,class:"w-full"},{default:w(()=>s[29]||(s[29]=[u(" Ver Lista de Encuestas ")])),_:1,__:[29]})])])):m("",!0)])}}};export{Is as default};

import{D as B,d as p,B as y,f as I,o as n,h as d,j as t,v as a,z as i,u as b,J as f,t as r,F,y as M,E as m,c as R,l as V}from"./vue-vendor-B77bLtTV.js";import{e as k,u as L,s as _,M as w,P as v,f as C,A as G,R as O,g as H,S as J,h as K,i as Q,C as U}from"./index-C3zR6LNs.js";import"./supabase-B7V2753y.js";import"./charts-CTwtOHf5.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=k("AlertOctagonIcon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=k("CircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Y={class:"space-y-8"},Z={class:"bg-gradient-to-r from-green-600 to-teal-600 rounded-2xl shadow-xl p-8"},tt={class:"flex items-center justify-between"},et={class:"flex items-center space-x-4"},st={class:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center"},ot={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},rt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},at={class:"text-4xl font-bold text-green-600"},nt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},it={class:"text-4xl font-bold text-blue-600"},lt={class:"bg-white rounded-xl shadow-lg p-6 text-center border border-gray-200"},dt={class:"text-4xl font-bold text-purple-600"},ct={key:0,class:"flex items-center justify-center py-12"},ut={key:1,class:"bg-red-50 border border-red-200 rounded-xl p-8 text-center"},xt={class:"text-red-600 mb-4"},pt={key:2,class:"bg-white rounded-xl shadow-lg border border-gray-200"},mt={key:3,class:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden"},gt={class:"overflow-x-auto"},ht={class:"w-full"},yt={class:"divide-y divide-gray-200"},bt={class:"px-6 py-4"},ft={class:"max-w-md"},_t={class:"text-sm font-medium text-gray-900 mb-1"},wt={class:"text-xs text-gray-500 line-clamp-2"},vt={class:"px-6 py-4 whitespace-nowrap"},Ct={class:"px-6 py-4 whitespace-nowrap"},kt={class:"flex items-center gap-2"},Et={class:"text-sm font-medium text-gray-900 capitalize"},Dt={class:"px-6 py-4 whitespace-nowrap"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},St={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},jt={class:"flex items-center justify-end gap-2"},Nt=["onClick"],Pt=["onClick"],It={__name:"GestionComunicadosView",setup(qt){const g=B(),E=L(),l=p([]),u=p(!0),c=p(null),D=y(()=>{const s=new Date;return s.setDate(s.getDate()-7),l.value.filter(e=>new Date(e.created_at)>=s).length}),A=y(()=>{if(l.value.length===0)return"-";const s=l.value[0],e=Math.floor((new Date-new Date(s.created_at))/(1e3*60*60*24));return e===0?"Hoy":`${e} día${e!==1?"s":""}`});I(async()=>{await x()});const x=async()=>{u.value=!0,c.value=null;try{const{data:s,error:e}=await _.from("comunicados").select("*").eq("empresa_id",E.empresaId).order("created_at",{ascending:!1});if(e)throw e;l.value=s||[]}catch(s){console.error("Error cargando comunicados:",s),c.value="No se pudieron cargar los comunicados"}finally{u.value=!1}},h=()=>{g.push("/admin/comunicados/crear")},S=s=>{g.push(`/admin/comunicados/${s}/editar`)},j=async s=>{if(confirm("¿Estás seguro de eliminar este comunicado?"))try{const{error:e}=await _.from("comunicados").delete().eq("id",s);if(e)throw e;await x()}catch(e){console.error("Error eliminando comunicado:",e),alert("Error al eliminar el comunicado")}},N=s=>({informativo:"bg-blue-100 text-blue-800",urgente:"bg-red-100 text-red-800",anuncio:"bg-green-100 text-green-800",celebracion:"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",P=s=>({borrador:"bg-yellow-100 text-yellow-800",programado:"bg-blue-100 text-blue-800",enviado:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",q=s=>({alta:W,media:Q,baja:U})[s]||X,$=s=>({alta:"text-red-500",media:"text-yellow-500",baja:"text-green-500"})[s]||"text-gray-400",T=s=>new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(s,e)=>(n(),d("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[t("div",st,[a(i(w),{class:"h-8 w-8 text-white"})]),e[0]||(e[0]=t("div",null,[t("h1",{class:"text-3xl font-bold text-white"},"Gestión de Comunicados"),t("p",{class:"text-white/80 mt-1"},"Administra los mensajes para tu equipo")],-1))]),a(C,{onClick:h,class:"bg-white text-green-600 font-semibold hover:bg-green-50"},{default:b(()=>[a(i(v),{class:"h-5 w-5 mr-2"}),e[1]||(e[1]=f(" Nuevo Comunicado "))]),_:1,__:[1]})])]),t("div",ot,[t("div",rt,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Total Comunicados",-1)),t("p",at,r(l.value.length),1),e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 mt-1"},"Publicados",-1))]),t("div",nt,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Esta Semana",-1)),t("p",it,r(D.value),1),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 mt-1"},"Nuevos",-1))]),t("div",lt,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Último Comunicado",-1)),t("p",dt,r(A.value),1),e[7]||(e[7]=t("p",{class:"text-sm text-gray-500 mt-1"},"Publicación",-1))])]),u.value?(n(),d("div",ct,e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"},null,-1)]))):c.value?(n(),d("div",ut,[a(i(G),{class:"h-12 w-12 text-red-500 mx-auto mb-4"}),e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-red-800 mb-2"},"Error al cargar los comunicados",-1)),t("p",xt,r(c.value),1),a(C,{onClick:x},{default:b(()=>[a(i(O),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=f(" Reintentar "))]),_:1,__:[9]})])):l.value.length===0?(n(),d("div",pt,[a(H,{icon:i(w),title:"No hay comunicados",description:"Crea tu primer comunicado para mantener informado a tu equipo.","action-text":"Crear comunicado","action-icon":i(v),onAction:h},null,8,["icon","action-icon"])])):(n(),d("div",mt,[t("div",gt,[t("table",ht,[e[11]||(e[11]=t("thead",{class:"bg-gray-50 border-b border-gray-200"},[t("tr",null,[t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Comunicado "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Tipo "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Prioridad "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Estado "),t("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Fecha "),t("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ")])],-1)),t("tbody",yt,[(n(!0),d(F,null,M(l.value,o=>(n(),d("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[t("td",bt,[t("div",ft,[t("div",_t,r(o.titulo),1),t("div",wt,r(o.contenido),1)])]),t("td",vt,[t("span",{class:m([N(o.tipo),"px-3 py-1 text-xs font-medium rounded-full capitalize"])},r(o.tipo),3)]),t("td",Ct,[t("div",kt,[(n(),R(V(q(o.prioridad)),{class:m([$(o.prioridad),"h-5 w-5"])},null,8,["class"])),t("span",Et,r(o.prioridad),1)])]),t("td",Dt,[t("span",{class:m([P(o.estado),"px-3 py-1 text-xs font-medium rounded-full capitalize"])},r(o.estado),3)]),t("td",At,r(T(o.created_at)),1),t("td",St,[t("div",jt,[t("button",{onClick:z=>S(o.id),class:"text-blue-600 hover:text-blue-900 transition-colors",title:"Editar"},[a(i(J),{class:"h-4 w-4"})],8,Nt),t("button",{onClick:z=>j(o.id),class:"text-red-600 hover:text-red-900 transition-colors",title:"Eliminar"},[a(i(K),{class:"h-4 w-4"})],8,Pt)])])]))),128))])])])]))]))}};export{It as default};

import{W as J,b as W,l as v,n as D,o as Y,d as r,i as d,e,w,_ as k,t as a,h as m,f as c,k as u,v as E,g as G,a3 as K,z as Q,X as Z,F as N,r as V,E as ee,q as se,p as te,j as l,P as j,D as ae,aj as oe,ac as ie,ad as ne,a4 as le,L as re,Y as de}from"./index-9XWXAznh.js";import{_ as ce}from"./Header-CQM0Mtxj.js";import{S as T}from"./shield-check-CtW9Ljbn.js";import{A as ue}from"./arrow-left-Q60brOqV.js";import{E as me}from"./eye-DW_jvoXF.js";import{X as ge}from"./x-BqrVQl_H.js";import{S as pe}from"./shield-DpWnIVyF.js";const b=[{id:1,nombre:"RRHH",empleados:8,color:"bg-blue-100 text-blue-800"},{id:2,nombre:"Marketing",empleados:12,color:"bg-purple-100 text-purple-800"},{id:3,nombre:"Ventas",empleados:15,color:"bg-green-100 text-green-800"},{id:4,nombre:"Producción",empleados:10,color:"bg-orange-100 text-orange-800"},{id:5,nombre:"Desarrollo",empleados:18,color:"bg-indigo-100 text-indigo-800"},{id:6,nombre:"Administración",empleados:7,color:"bg-gray-100 text-gray-800"}],ve=()=>b.reduce((P,g)=>P+g.empleados,0),xe={class:"min-h-screen bg-gray-50"},be={class:"py-8"},fe={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8"},_e={class:"mb-8"},ye={class:"flex items-center justify-between"},he={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},we={class:"lg:col-span-2 space-y-6"},ke={class:"bg-white rounded-xl shadow-sm p-6"},Ee={class:"space-y-4"},Ce={class:"text-lg font-medium text-gray-900 mt-1"},Se={key:0},De={class:"text-gray-700 mt-1"},Ne={class:"flex items-center gap-6 pt-2 flex-wrap"},Ve={class:"flex items-center text-sm text-gray-600"},je={class:"flex items-center text-sm text-gray-600"},Pe={class:"pt-4 border-t border-gray-200"},Ae={class:"font-semibold text-sm"},Le={class:"text-xs mt-1 text-gray-600"},Te={class:"mt-6"},Re={class:"bg-white rounded-xl shadow-sm p-6"},ze={class:"mb-4"},$e={class:"ml-3 flex-1"},Me={class:"flex items-center justify-between"},Be={class:"text-sm font-medium text-indigo-700"},Fe={class:"space-y-3"},qe=["onClick"],Ie=["checked","onChange"],Ue={class:"ml-3 flex-1 flex items-center justify-between"},He={class:"font-medium text-gray-900"},Oe={class:"text-sm text-gray-600"},Xe={class:"lg:col-span-1"},Je={class:"bg-white rounded-xl shadow-sm p-6 sticky top-6"},We={class:"space-y-4 text-sm"},Ye={class:"flex items-start"},Ge={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},Ke={class:"flex-1"},Qe={class:"text-gray-600 mt-1"},Ze={class:"flex items-start"},es={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},ss={class:"flex-1"},ts={class:"text-gray-600 mt-1"},as={class:"flex items-start"},os={class:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},is={class:"flex-1"},ns={class:"text-gray-600 mt-1"},ls={class:"text-indigo-600 font-semibold mt-1"},rs={class:"mt-6 pt-6 border-t border-gray-200"},ds={key:0,class:"text-xs text-gray-500 mt-2 text-center"},cs={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},us={class:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},ms={class:"sticky top-0 bg-white border-b border-gray-200 p-6 z-10"},gs={class:"flex justify-between items-start"},ps={class:"p-6"},vs={class:"bg-gray-50 rounded-lg p-6 mb-4"},xs={class:"text-xl font-bold text-gray-900 mb-2"},bs={key:0,class:"text-gray-600 mb-4"},fs={class:"flex items-center text-sm text-gray-500"},_s={key:0,class:"bg-white border border-gray-200 rounded-lg p-6"},ys={class:"mb-4"},hs={class:"text-sm text-gray-500"},ws={class:"text-lg font-medium text-gray-900 mb-4"},ks={key:0,class:"space-y-3"},Es={class:"flex items-center justify-between"},Cs={class:"text-sm font-medium text-gray-700"},Ss={key:1,class:"space-y-3"},Ds={key:2,class:"space-y-3"},Ns={class:"text-gray-700"},Vs={key:3,class:"space-y-3"},js={class:"text-xs text-green-600 flex items-center"},Ps={class:"mt-6 flex justify-end"},As={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Ls={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 text-center"},Ts={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},Rs={class:"text-gray-600 mb-6"},Us={__name:"VistaPreviaEnvio",setup(P){const g=se();te();const f=J(),R=W(),t=v({titulo:"",descripcion:"",preguntas:[],categoria:"",creada_desde:"custom"}),i=v([]),x=v(!1),C=v(!1),_=v(!1),A=v(!1),z=D(()=>ve()),y=D(()=>i.value.reduce((o,s)=>{const p=b.find(h=>h.id===s);return o+((p==null?void 0:p.empleados)||0)},0)),$=D(()=>new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}));Y(()=>{M()});const M=()=>{const o=sessionStorage.getItem("encuesta_preview");if(o)try{t.value=JSON.parse(o)}catch(s){console.error("Error al cargar datos de encuesta:",s),f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los datos de la encuesta",life:4e3}),g.push("/admin/encuestas")}else f.add({severity:"warn",summary:"Sin datos",detail:"No hay datos de encuesta para previsualizar",life:4e3}),g.push("/admin/encuestas")},L=o=>{const s=i.value.indexOf(o);s>-1?i.value.splice(s,1):i.value.push(o),x.value=i.value.length===b.length},B=()=>{x.value?i.value=b.map(o=>o.id):i.value=[]},F=async()=>{if(i.value.length===0){f.add({severity:"warn",summary:"Sin destinatarios",detail:"Debes seleccionar al menos un departamento",life:4e3});return}C.value=!0;try{await new Promise(o=>setTimeout(o,1500)),await R.createNewSurvey({...t.value,estado:"activa",fecha_envio:new Date,departamentos_destinatarios:i.value,total_destinatarios:y.value}),sessionStorage.removeItem("encuesta_preview"),A.value=!0}catch(o){console.error("Error al enviar encuesta:",o),f.add({severity:"error",summary:"Error al enviar",detail:o.message||"No se pudo enviar la encuesta",life:5e3})}finally{C.value=!1}},q=()=>{g.back()},I=()=>{g.push("/admin/encuestas")},U=o=>({anonimato_completo:T,anonimato_parcial:re,identificado:de})[o]||T,H=o=>({anonimato_completo:"Anónimo completo",anonimato_parcial:"Anónimo parcial",identificado:"Identificado (con propósito)"})[o]||"Anónimo completo",O=o=>({anonimato_completo:"Respuestas 100% anónimas sin identificadores",anonimato_parcial:"Agrupadas por departamento sin datos individuales",identificado:"Asociadas al usuario con fines de seguimiento"})[o]||"Respuestas 100% anónimas",X=o=>({anonimato_completo:"bg-green-50 border-green-300 text-green-800",anonimato_parcial:"bg-orange-50 border-orange-300 text-orange-800",identificado:"bg-blue-50 border-blue-300 text-blue-800"})[o]||"bg-green-50 border-green-300 text-green-800";return(o,s)=>{var p,h;return l(),r("div",xe,[d(ce,{subtitulo:"Vista Previa de Envío"}),e("div",be,[e("div",fe,[e("div",_e,[e("div",ye,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Vista Previa de Envío"),e("p",{class:"mt-2 text-lg text-gray-600"},"Selecciona los destinatarios de tu encuesta")],-1)),d(k,{onClick:q,variant:"outline"},{default:w(()=>[d(c(ue),{class:"h-5 w-5 mr-2"}),s[5]||(s[5]=u(" Volver "))]),_:1,__:[5]})])]),e("div",he,[e("div",we,[e("div",ke,[s[12]||(s[12]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Resumen de la Encuesta",-1)),e("div",Ee,[e("div",null,[s[7]||(s[7]=e("label",{class:"text-sm font-medium text-gray-500"},"Título",-1)),e("p",Ce,a(t.value.titulo),1)]),t.value.descripcion?(l(),r("div",Se,[s[8]||(s[8]=e("label",{class:"text-sm font-medium text-gray-500"},"Descripción",-1)),e("p",De,a(t.value.descripcion),1)])):m("",!0),e("div",Ne,[e("div",Ve,[d(c(j),{class:"h-5 w-5 mr-2 text-primary"}),e("span",null,[e("strong",null,a(((p=t.value.preguntas)==null?void 0:p.length)||0),1),s[9]||(s[9]=u(" preguntas"))])]),e("div",je,[e("span",{class:E(["px-3 py-1 rounded-full text-xs font-medium",t.value.creada_desde==="plantilla"?"bg-indigo-50 text-indigo-800":"bg-gray-50 text-gray-800"])},a(t.value.creada_desde==="plantilla"?"🧩 Desde plantilla":"🧱 Desde cero"),3)])]),e("div",Pe,[s[10]||(s[10]=e("label",{class:"text-sm font-medium text-gray-500 mb-2 block"},"Nivel de Privacidad",-1)),e("div",{class:E(["flex items-start p-3 rounded-lg border-2",X(t.value.privacidadNivel||"anonimato_completo")])},[(l(),G(K(U(t.value.privacidadNivel||"anonimato_completo")),{class:"h-5 w-5 mt-0.5 mr-3 flex-shrink-0"})),e("div",null,[e("p",Ae,a(H(t.value.privacidadNivel||"anonimato_completo")),1),e("p",Le,a(O(t.value.privacidadNivel||"anonimato_completo")),1)])],2)])]),e("div",Te,[e("button",{onClick:s[0]||(s[0]=n=>_.value=!0),class:"text-primary hover:text-primary-dark font-medium text-sm flex items-center"},[d(c(me),{class:"h-4 w-4 mr-2"}),s[11]||(s[11]=u(" Ver cómo la recibe un empleado "))])])]),e("div",Re,[s[14]||(s[14]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Seleccionar Destinatarios",-1)),s[15]||(s[15]=e("p",{class:"text-sm text-gray-600 mb-6"}," Selecciona los departamentos o grupos de empleados a los que deseas enviar esta encuesta. ",-1)),e("div",ze,[e("label",{class:E(["flex items-center p-4 bg-indigo-50 border-2 border-indigo-200 rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors",{"ring-2 ring-indigo-500":x.value}])},[Q(e("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=n=>x.value=n),onChange:B,class:"h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,544),[[Z,x.value]]),e("div",$e,[e("div",Me,[s[13]||(s[13]=e("span",{class:"font-semibold text-gray-900"},"Todos los empleados",-1)),e("span",Be,a(z.value)+" empleados ",1)])])],2)]),e("div",Fe,[(l(!0),r(N,null,V(c(b),n=>(l(),r("div",{key:n.id,class:E(["flex items-center p-3 bg-gray-50 hover:bg-indigo-50 rounded-lg cursor-pointer transition-colors border-2",i.value.includes(n.id)?"border-indigo-300 bg-indigo-50":"border-transparent"]),onClick:S=>L(n.id)},[e("input",{type:"checkbox",checked:i.value.includes(n.id),onChange:S=>L(n.id),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",onClick:s[2]||(s[2]=ae(()=>{},["stop"]))},null,40,Ie),e("div",Ue,[e("div",null,[e("span",He,a(n.nombre),1)]),e("span",Oe,a(n.empleados)+" empleados ",1)])],10,qe))),128))])])]),e("div",Xe,[e("div",Je,[s[20]||(s[20]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Resumen de Envío",-1)),e("div",We,[e("div",Ye,[e("div",Ge,[d(c(j),{class:"h-4 w-4 text-indigo-600"})]),e("div",Ke,[s[16]||(s[16]=e("p",{class:"font-medium text-gray-700"},"Encuesta",-1)),e("p",Qe,a(t.value.titulo),1)])]),e("div",Ze,[e("div",es,[d(c(oe),{class:"h-4 w-4 text-indigo-600"})]),e("div",ss,[s[17]||(s[17]=e("p",{class:"font-medium text-gray-700"},"Fecha de creación",-1)),e("p",ts,a($.value),1)])]),e("div",as,[e("div",os,[d(c(ie),{class:"h-4 w-4 text-indigo-600"})]),e("div",is,[s[18]||(s[18]=e("p",{class:"font-medium text-gray-700"},"Destinatarios",-1)),e("p",ns,a(i.value.length)+" departamento"+a(i.value.length!==1?"s":""),1),e("p",ls,a(y.value)+" empleado"+a(y.value!==1?"s":""),1)])])]),e("div",rs,[d(k,{onClick:F,disabled:i.value.length===0,loading:C.value,class:"w-full bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-gray-300"},{default:w(()=>[d(c(ne),{class:"h-4 w-4 mr-2"}),s[19]||(s[19]=u(" Enviar Encuesta "))]),_:1,__:[19]},8,["disabled","loading"]),i.value.length===0?(l(),r("p",ds," Selecciona al menos un departamento ")):m("",!0)])])])])])]),_.value?(l(),r("div",cs,[e("div",us,[e("div",ms,[e("div",gs,[s[21]||(s[21]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-900"},"Vista Previa"),e("p",{class:"text-gray-600 mt-1"},"Así verá la encuesta un empleado")],-1)),e("button",{onClick:s[3]||(s[3]=n=>_.value=!1),class:"text-gray-400 hover:text-gray-600 transition-colors"},[d(c(ge),{class:"h-6 w-6"})])])]),e("div",ps,[e("div",vs,[e("h3",xs,a(t.value.titulo),1),t.value.descripcion?(l(),r("p",bs,a(t.value.descripcion),1)):m("",!0),e("div",fs,[d(c(j),{class:"h-4 w-4 mr-2"}),u(" "+a(((h=t.value.preguntas)==null?void 0:h.length)||0)+" preguntas ",1)])]),t.value.preguntas&&t.value.preguntas.length>0?(l(),r("div",_s,[e("div",ys,[e("span",hs,"Pregunta 1 de "+a(t.value.preguntas.length),1)]),e("h4",ws,a(t.value.preguntas[0].texto),1),t.value.preguntas[0].tipo==="escala_1_5"?(l(),r("div",ks,[s[23]||(s[23]=e("div",{class:"flex items-center justify-between text-sm text-gray-500 mb-2"},[e("span",null,"Muy insatisfecho"),e("span",null,"Muy satisfecho")],-1)),e("div",Es,[(l(),r(N,null,V([1,2,3,4,5],n=>e("div",{key:n,class:"flex flex-col items-center"},[s[22]||(s[22]=e("input",{type:"radio",name:"preview-escala",class:"mb-2 h-5 w-5",disabled:""},null,-1)),e("span",Cs,a(n),1)])),64))])])):t.value.preguntas[0].tipo==="si_no"?(l(),r("div",Ss,s[24]||(s[24]=[ee('<label class="flex items-center p-3 bg-gray-50 rounded-lg"><input type="radio" name="preview-sino" class="mr-3 h-4 w-4" disabled><span class="text-gray-700">Sí</span></label><label class="flex items-center p-3 bg-gray-50 rounded-lg"><input type="radio" name="preview-sino" class="mr-3 h-4 w-4" disabled><span class="text-gray-700">No</span></label>',2)]))):t.value.preguntas[0].tipo==="opcion_multiple"?(l(),r("div",Ds,[(l(!0),r(N,null,V(t.value.preguntas[0].opciones,(n,S)=>(l(),r("label",{key:S,class:"flex items-center p-3 bg-gray-50 rounded-lg"},[s[25]||(s[25]=e("input",{type:"radio",name:"preview-multiple",class:"mr-3 h-4 w-4",disabled:""},null,-1)),e("span",Ns,a(n),1)]))),128))])):t.value.preguntas[0].tipo==="texto_abierto"?(l(),r("div",Vs,[s[27]||(s[27]=e("textarea",{class:"w-full px-3 py-2 border border-gray-300 rounded-md resize-none",rows:"4",placeholder:"Escribe tu respuesta aquí...",disabled:""},null,-1)),e("p",js,[d(c(pe),{class:"h-4 w-4 mr-1"}),s[26]||(s[26]=u(" Tu respuesta es 100% anónima "))])])):m("",!0)])):m("",!0),e("div",Ps,[d(k,{onClick:s[4]||(s[4]=n=>_.value=!1),variant:"outline"},{default:w(()=>s[28]||(s[28]=[u(" Cerrar Vista Previa ")])),_:1,__:[28]})])])])])):m("",!0),A.value?(l(),r("div",As,[e("div",Ls,[e("div",Ts,[d(c(le),{class:"h-10 w-10 text-green-600"})]),s[30]||(s[30]=e("h3",{class:"text-2xl font-bold text-gray-900 mb-2"},"¡Encuesta Enviada!",-1)),e("p",Rs," La encuesta ha sido enviada correctamente a "+a(y.value)+" empleados en "+a(i.value.length)+" departamento"+a(i.value.length!==1?"s":"")+". ",1),d(k,{onClick:I,class:"w-full"},{default:w(()=>s[29]||(s[29]=[u(" Ver Lista de Encuestas ")])),_:1,__:[29]})])])):m("",!0)])}}};export{Us as default};

import{d as k,B as R,f as H,h as m,j as e,v as d,z as r,t as a,I as J,E as K,c as A,l as z,M as V,b as L,F,y as N,D as Y,o as n}from"./vue-vendor-DLSXyIw7.js";import{d as Q,s as C,u as W,A as $,v as X,H as Z,T as I,U as ee,F as te,C as O,B as se}from"./index-D33O_vwf.js";import{o as ae,g as oe}from"./analiticaMock-_jbItO_4.js";import{T as B,M as S}from"./trending-down-BiwrHWy_.js";import{A as re}from"./alert-triangle-Dg4Dpai8.js";import{B as ie}from"./building-2-sddyofuc.js";import{A as ne}from"./award-hHVJkT0t.js";import{I as le}from"./info-DXoeYcFN.js";import"./supabase-B7V2753y.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=Q("LineChartIcon",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),T={async getAnalytics(w){try{const{data:c,error:g}=await C.from("encuestas").select("id, titulo, estado").eq("empresa_id",w);if(g)throw g;const{data:o,error:x}=await C.from("respuestas_encuesta").select(`
          *,
          preguntas_encuesta (
            *
          ),
          empleados (
            departamento_id,
            departamentos (
              nombre
            )
          )
        `).in("encuesta_id",c.map(i=>i.id));if(x)throw x;const{data:u,error:v}=await C.from("departamentos").select("id, nombre").eq("empresa_id",w);if(v)throw v;const{data:_,error:l}=await C.from("empleados").select("id, departamento_id, estado").eq("empresa_id",w);if(l)throw l;const b=_.filter(i=>i.estado==="Activo").length,p=o.length,y=c.filter(i=>i.estado==="activa").length,j=c.filter(i=>i.estado==="cerrada").length,t=o.filter(i=>{const h=parseInt(i.respuesta);return!isNaN(h)&&h>=1&&h<=5}),s=t.length>0?t.reduce((i,h)=>i+parseInt(h.respuesta),0)/t.length:0,D=b>0?Math.round(p/(b*c.length)*100):0,P=u.map(i=>{const h=_.filter(E=>E.departamento_id===i.id),M=o.filter(E=>{var f;return((f=E.empleados)==null?void 0:f.departamento_id)===i.id}).filter(E=>{const f=parseInt(E.respuesta);return!isNaN(f)&&f>=1&&f<=5}),G=M.length>0?M.reduce((E,f)=>E+parseInt(f.respuesta),0)/M.length:0;return{nombre:i.nombre,empleados:h.length,promedio:G,tendencia:G>=4?"up":"stable"}}),U=[...P].sort((i,h)=>h.promedio-i.promedio).slice(0,3),q=[...P].filter(i=>i.promedio<3.5).sort((i,h)=>i.promedio-h.promedio).slice(0,3);return{bienestar_global:s,variacion_trimestral:.2,participacion_global:D,alertas_activas:q.length,encuestas_activas:y,encuestas_completadas:j,empleados_totales:b,departamentos_fuertes:U,departamentos_criticos:q}}catch(c){throw console.error("Error obteniendo analítica:",c),c}},async getEvolution(w,c=6){try{const g=new Date;g.setMonth(g.getMonth()-c);const{data:o,error:x}=await C.from("respuestas_encuesta").select(`
          *,
          encuestas!inner (
            empresa_id,
            fecha_creacion
          )
        `).eq("encuestas.empresa_id",w).gte("created_at",g.toISOString());if(x)throw x;const u={},v=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];return o.forEach(l=>{const b=new Date(l.created_at),p=`${v[b.getMonth()]} ${b.getFullYear()}`;u[p]||(u[p]={mes:p,suma:0,cantidad:0,totalParticipantes:new Set});const y=parseInt(l.respuesta);!isNaN(y)&&y>=1&&y<=5&&(u[p].suma+=y,u[p].cantidad++),l.empleado_id&&u[p].totalParticipantes.add(l.empleado_id)}),Object.values(u).map(l=>({mes:l.mes,valor:l.cantidad>0?l.suma/l.cantidad:0,participacion:l.totalParticipantes.size}))}catch(g){throw console.error("Error obteniendo evolución:",g),g}},async getCategorias(w){try{return[{categoria:"Físico",valor:4.2,variacion:.3},{categoria:"Mental",valor:3.8,variacion:-.1},{categoria:"Social",valor:4.5,variacion:.2},{categoria:"Financiero",valor:3.9,variacion:0},{categoria:"Profesional",valor:4.1,variacion:.1}]}catch(c){throw console.error("Error obteniendo categorías:",c),c}}},ce={class:"min-h-screen bg-gray-50"},me={key:0,class:"flex items-center justify-center py-12"},ge={key:1,class:"bg-white border border-gray-300 rounded-lg p-8 text-center"},ue={class:"text-gray-600 mb-4"},pe={key:2,class:"max-w-7xl mx-auto"},he={class:"mb-8 flex items-center justify-between"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ve={class:"bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},_e={class:"flex items-center justify-between mb-4"},be={class:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center"},ye={class:"text-xs font-semibold text-gray-900"},fe={class:"text-4xl font-bold text-gray-900"},we={class:"bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},je={class:"flex items-center justify-between mb-4"},Ee={class:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center"},ke={class:"text-4xl font-bold text-gray-900"},Ce={class:"bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},De={class:"flex items-center justify-between mb-4"},Ae={class:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center"},Fe={class:"text-4xl font-bold text-gray-900"},Ne={class:"mt-3 w-full bg-gray-200 rounded-full h-2"},Ie={class:"bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},Me={class:"flex items-center justify-between mb-4"},Be={class:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center"},Se={key:0,class:"flex h-3 w-3"},Te={class:"text-4xl font-bold text-gray-900"},Pe={class:"text-xs text-gray-500 mt-1"},qe={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},Ge={class:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm"},Re={class:"flex items-center justify-between"},ze={class:"text-3xl font-bold text-gray-900"},Ve={class:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm"},Le={class:"flex items-center justify-between"},$e={class:"text-3xl font-bold text-gray-900"},Oe={class:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm"},Ue={class:"flex items-center justify-between"},He={class:"text-3xl font-bold text-gray-900"},Je={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"},Ke={class:"bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200"},Ye={class:"bg-gray-100 px-6 py-4 border-b border-gray-200"},Qe={class:"flex items-center"},We={class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center mr-3"},Xe={class:"p-6 space-y-3"},Ze={class:"flex items-center justify-between"},et={class:"flex items-center gap-3"},tt={class:"w-10 h-10 bg-gray-900 rounded-full flex items-center justify-center text-white font-bold"},st={class:"font-semibold text-gray-900"},at={class:"text-xs text-gray-600"},ot={class:"text-right"},rt={class:"text-2xl font-bold text-gray-900"},it={class:"flex items-center justify-end mt-1"},nt={class:"bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200"},lt={class:"bg-gray-100 px-6 py-4 border-b border-gray-200"},dt={class:"flex items-center"},ct={class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center mr-3"},mt={class:"p-6 space-y-3"},gt={class:"flex items-center justify-between"},ut={class:"flex items-center gap-3"},pt={class:"font-semibold text-gray-900"},ht={class:"text-xs text-gray-600"},xt={class:"text-right"},vt={class:"text-2xl font-bold text-gray-900"},_t={class:"flex items-center justify-end mt-1"},bt={key:0,class:"text-center py-8 text-gray-500"},yt={class:"bg-white rounded-lg p-6 shadow-sm mb-8 border border-gray-200"},ft={class:"flex items-center mb-6"},wt={class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center mr-3"},jt={class:"space-y-4"},Et={class:"w-24 flex-shrink-0"},kt={class:"text-sm font-medium text-gray-700"},Ct={class:"flex-1"},Dt={class:"flex items-center gap-3"},At={class:"flex-1 relative"},Ft={class:"w-full bg-gray-200 rounded-full h-8 relative overflow-hidden"},Nt={class:"text-white font-bold text-sm"},It={class:"w-20 text-right"},Mt={class:"text-xs text-gray-500"},Bt={class:"bg-white rounded-lg p-6 shadow-sm mb-8 border border-gray-200"},St={class:"flex items-center mb-6"},Tt={class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center mr-3"},Pt={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},qt={class:"text-xs font-medium text-gray-600 mb-2"},Gt={class:"text-2xl font-bold text-gray-900 mb-1"},Rt={class:"flex items-center"},zt={class:"text-sm font-medium text-gray-900"},Vt={class:"bg-white rounded-lg p-6 shadow-sm border-l-4 border-gray-900"},Lt={class:"flex items-start"},$t={class:"w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0"},Ot={class:"text-gray-700 text-sm leading-relaxed italic"},ts={__name:"AnaliticaEjecutiva",setup(w){const c=Y(),g=W(),o=k({bienestar_global:0,variacion_trimestral:0,participacion_global:0,alertas_activas:0,encuestas_activas:0,encuestas_completadas:0,empleados_totales:0,departamentos_fuertes:[],departamentos_criticos:[]}),x=k([]),u=k([]),v=k(!0),_=k(null),l=R(()=>({...ae(o.value.bienestar_global),border:"border-gray-300"})),b=R(()=>oe(o.value));H(async()=>{await p()});const p=async()=>{v.value=!0,_.value=null;try{const[j,t,s]=await Promise.all([T.getAnalytics(g.empresaId),T.getEvolution(g.empresaId),T.getCategorias(g.empresaId)]);o.value=j,x.value=t,u.value=s}catch(j){console.error("Error cargando analítica:",j),_.value="No se pudieron cargar los datos"}finally{v.value=!1}},y=()=>{c.push("/admin/presentacion")};return(j,t)=>(n(),m("div",ce,[v.value?(n(),m("div",me,t[0]||(t[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},null,-1)]))):_.value?(n(),m("div",ge,[d(r($),{class:"h-12 w-12 text-gray-700 mx-auto mb-4"}),t[1]||(t[1]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Error al cargar datos",-1)),e("p",ue,a(_.value),1),e("button",{onClick:p,class:"px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"}," Reintentar ")])):(n(),m("div",pe,[e("div",he,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Analítica Ejecutiva Consolidada"),e("p",{class:"text-gray-600 mt-2"},"Resumen general de bienestar y participación organizacional")],-1)),e("button",{onClick:y,class:"flex items-center gap-2 px-5 py-3 bg-black text-white rounded-lg font-medium hover:bg-gray-800 transition-colors shadow-sm"},[d(r(X),{class:"h-5 w-5"}),t[2]||(t[2]=J(" Modo Presentación "))])]),e("div",xe,[e("div",ve,[e("div",_e,[e("div",be,[d(r(Z),{class:"h-6 w-6 text-white"})]),e("div",{class:K([l.value.border,"px-3 py-1 rounded-full border-2"])},[e("span",ye,a(l.value.label),1)],2)]),t[4]||(t[4]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Índice Global de Bienestar",-1)),e("p",fe,a(o.value.bienestar_global.toFixed(1)),1),t[5]||(t[5]=e("p",{class:"text-xs text-gray-500 mt-1"},"de 5.0",-1))]),e("div",we,[e("div",je,[e("div",Ee,[d(r(I),{class:"h-6 w-6 text-white"})]),(n(),A(z(o.value.variacion_trimestral>0?r(I):o.value.variacion_trimestral<0?r(B):r(S)),{class:"h-6 w-6 text-gray-900"}))]),t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Variación Trimestral",-1)),e("p",ke,a(o.value.variacion_trimestral>0?"+":"")+a(o.value.variacion_trimestral.toFixed(1)),1),t[7]||(t[7]=e("p",{class:"text-xs text-gray-500 mt-1"},"vs. trimestre anterior",-1))]),e("div",Ce,[e("div",De,[e("div",Ae,[d(r(ee),{class:"h-6 w-6 text-white"})])]),t[8]||(t[8]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Participación Global",-1)),e("p",Fe,a(o.value.participacion_global)+"%",1),e("div",Ne,[e("div",{class:"bg-gray-900 h-2 rounded-full transition-all duration-500",style:V({width:`${o.value.participacion_global}%`})},null,4)])]),e("div",Ie,[e("div",Me,[e("div",Be,[d(r(re),{class:"h-6 w-6 text-white"})]),o.value.alertas_activas>0?(n(),m("span",Se,t[9]||(t[9]=[e("span",{class:"animate-ping absolute inline-flex h-3 w-3 rounded-full bg-gray-400 opacity-75"},null,-1),e("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-gray-900"},null,-1)]))):L("",!0)]),t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-500 mb-1"},"Alertas Activas",-1)),e("p",Te,a(o.value.alertas_activas),1),e("p",Pe,a(o.value.alertas_activas===0?"Sin alertas":"Requieren atención"),1)])]),e("div",qe,[e("div",Ge,[e("div",Re,[e("div",null,[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Encuestas Activas",-1)),e("p",ze,a(o.value.encuestas_activas),1)]),d(r(te),{class:"h-10 w-10 text-gray-400"})])]),e("div",Ve,[e("div",Le,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Encuestas Completadas",-1)),e("p",$e,a(o.value.encuestas_completadas),1)]),d(r(O),{class:"h-10 w-10 text-gray-400"})])]),e("div",Oe,[e("div",Ue,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Empleados Totales",-1)),e("p",He,a(o.value.empleados_totales),1)]),d(r(ie),{class:"h-10 w-10 text-gray-400"})])])]),e("div",Je,[e("div",Ke,[e("div",Ye,[e("div",Qe,[e("div",We,[d(r(ne),{class:"h-5 w-5 text-white"})]),t[14]||(t[14]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-900"},"Top 3 Áreas Fuertes"),e("p",{class:"text-sm text-gray-600"},"Departamentos con mejor clima laboral")],-1))])]),e("div",Xe,[(n(!0),m(F,null,N(o.value.departamentos_fuertes,(s,D)=>(n(),m("div",{key:s.nombre,class:"bg-gray-50 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},[e("div",Ze,[e("div",et,[e("div",tt,a(D+1),1),e("div",null,[e("p",st,a(s.nombre),1),e("p",at,a(s.empleados)+" empleados",1)])]),e("div",ot,[e("p",rt,a(s.promedio.toFixed(1)),1),e("div",it,[s.tendencia==="up"?(n(),A(r(I),{key:0,class:"h-4 w-4 text-gray-900 mr-1"})):(n(),A(r(S),{key:1,class:"h-4 w-4 text-gray-400 mr-1"})),t[15]||(t[15]=e("span",{class:"text-xs text-gray-500"},"de 5.0",-1))])])])]))),128))])]),e("div",nt,[e("div",lt,[e("div",dt,[e("div",ct,[d(r($),{class:"h-5 w-5 text-white"})]),t[16]||(t[16]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-900"},"Áreas Críticas"),e("p",{class:"text-sm text-gray-600"},"Departamentos que requieren atención")],-1))])]),e("div",mt,[(n(!0),m(F,null,N(o.value.departamentos_criticos,(s,D)=>(n(),m("div",{key:s.nombre,class:"bg-gray-50 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow border border-gray-200"},[e("div",gt,[e("div",ut,[t[17]||(t[17]=e("div",{class:"w-10 h-10 bg-gray-900 rounded-full flex items-center justify-center text-white font-bold"}," ! ",-1)),e("div",null,[e("p",pt,a(s.nombre),1),e("p",ht,a(s.empleados)+" empleados",1)])]),e("div",xt,[e("p",vt,a(s.promedio.toFixed(1)),1),e("div",_t,[d(r(B),{class:"h-4 w-4 text-gray-900 mr-1"}),t[18]||(t[18]=e("span",{class:"text-xs text-gray-500"},"de 5.0",-1))])])])]))),128)),o.value.departamentos_criticos.length===0?(n(),m("div",bt,[d(r(O),{class:"h-12 w-12 text-gray-900 mx-auto mb-3"}),t[19]||(t[19]=e("p",{class:"text-sm"},"No hay departamentos en estado crítico",-1))])):L("",!0)])])]),e("div",yt,[e("div",ft,[e("div",wt,[d(r(de),{class:"h-5 w-5 text-white"})]),t[20]||(t[20]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Evolución del Bienestar Global"),e("p",{class:"text-sm text-gray-600"},"Últimos 6 meses")],-1))]),e("div",jt,[(n(!0),m(F,null,N(x.value,s=>(n(),m("div",{key:s.mes,class:"flex items-center gap-4"},[e("div",Et,[e("p",kt,a(s.mes),1)]),e("div",Ct,[e("div",Dt,[e("div",At,[e("div",Ft,[e("div",{class:"h-8 rounded-full transition-all duration-500 flex items-center justify-end pr-3 bg-gray-900",style:V({width:`${s.valor/5*100}%`})},[e("span",Nt,a(s.valor.toFixed(1)),1)],4)])]),e("div",It,[e("p",Mt,a(s.participacion)+"% part.",1)])])])]))),128))])]),e("div",Bt,[e("div",St,[e("div",Tt,[d(r(se),{class:"h-5 w-5 text-white"})]),t[21]||(t[21]=e("div",null,[e("h2",{class:"text-xl font-semibold text-gray-900"},"Categorías de Bienestar"),e("p",{class:"text-sm text-gray-600"},"Desglose por dimensión")],-1))]),e("div",Pt,[(n(!0),m(F,null,N(u.value,s=>(n(),m("div",{key:s.categoria,class:"bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-gray-400 transition-colors"},[e("p",qt,a(s.categoria),1),e("p",Gt,a(s.valor.toFixed(1)),1),e("div",Rt,[(n(),A(z(s.variacion>0?r(I):s.variacion<0?r(B):r(S)),{class:"h-4 w-4 mr-1 text-gray-900"})),e("span",zt,a(s.variacion>0?"+":"")+a(s.variacion.toFixed(1)),1)])]))),128))])]),e("div",Vt,[e("div",Lt,[e("div",$t,[d(r(le),{class:"h-5 w-5 text-white"})]),e("div",null,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Resumen Ejecutivo",-1)),e("p",Ot,a(b.value),1)])])])]))]))}};export{ts as default};
